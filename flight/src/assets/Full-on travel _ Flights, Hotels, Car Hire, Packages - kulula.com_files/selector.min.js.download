
ï»¿var _userTypes;var _airlines;var _segments;var _segmentTypes;var _travelclasses;var _userIP;var _selectorSegments;var _travellers;var dateOptions={minDate:'+0d',maxDate:'+331d',dateFormat:'dd M yy',numberOfMonths:1}
var dateOptions1={minDate:'+6w',maxDate:'+331d',dateFormat:'dd M yy',numberOfMonths:1}
var dateOptions2={minDate:'+2d',maxDate:'+331d',dateFormat:'dd M yy',numberOfMonths:1}
var dateOptions3={minDate:'+3d',maxDate:'+331d',dateFormat:'dd M yy',numberOfMonths:1}
var flatRateActivated=false;Date.prototype.addDays=function(days){var dat=new Date(this.valueOf());dat.setDate(dat.getDate()+days);return dat;}
var activeButton;var _countryIds=[];var countries=[["","Select country..."],["AF","Afghanistan"],["AL","Albania"],["DZ","Algeria"],["AS","American Samoa"],["AD","Andorra"],["AO","Angola"],["AI","Anguilla"],["AQ","Antarctica"],["AG","Antigua/Barbuda"],["AR","Argentina"],["AM","Armenia"],["AW","Aruba"],["AU","Australia"],["AT","Austria"],["AZ","Azerbaijan"],["BS","Bahamas"],["BH","Bahrain"],["BD","Bangladesh"],["BB","Barbados"],["BY","Belarus"],["BE","Belgium"],["BZ","Belize"],["BJ","Benin"],["BM","Bermuda"],["BT","Bhutan"],["BO","Bolivia"],["BA","Bosnia"],["BW","Botswana"],["BV","Bouvet Island"],["BR","Brazil"],["IO","British Ind. Ocn Terr."],["WI","British West Indies"],["BN","Brunei Darussalam"],["BG","Bulgaria"],["BF","Burkina Faso"],["BU","Burma"],["BI","Burundi"],["KH","Cambodia"],["CM","Cameroon"],["CA","Canada"],["CV","Cape Verde"],["KY","Cayman Islands"],["CF","Central Africa"],["TD","Chad"],["CL","Chile"],["CN","China"],["CX","Christmas Island"],["CC","Cocos Islands"],["CO","Colombia"],["KM","Comoros"],["CG","Congo"],["CK","Cook Islands"],["CR","Costa Rica"],["CI","Cote D'Ivoire"],["HR","Croatia"],["CU","Cuba"],["CY","Cyprus"],["CZ","Czech Republic"],["DK","Denmark"],["DJ","Djibouti"],["DM","Dominica"],["DO","Dominican Republic"],["TP","East Timor"],["EC","Ecuador"],["EG","Egypt"],["SV","El Salvador"],["GQ","Equatorial Guinea"],["ER","Eritrea"],["EE","Estonia"],["ET","Ethiopia"],["FO","Faeroe Islands"],["FK","Falkland Islands"],["FJ","Fiji"],["FI","Finland"],["FR","France"],["PF","French Polynesia"],["TF","French Southern Terr."],["GA","Gabon"],["GM","Gambia"],["XA","Gaza"],["GE","Georgia"],["DE","Germany"],["GH","Ghana"],["GI","Gibraltar"],["GR","Greece"],["GL","Greenland"],["GD","Grenada"],["GP","Guadeloupe"],["GU","Guam"],["GT","Guatemala"],["GF","Guiana"],["GN","Guinea"],["GW","Guinea-Bissau"],["GY","Guyana"],["HT","Haiti"],["HM","Heard &amp; McDnld Isl."],["XH","Held Territories"],["HN","Honduras"],["HK","Hong Kong"],["HU","Hungary"],["IS","Iceland"],["IN","India"],["XI","Indian Ocean Islands"],["ID","Indonesia"],["IR","Iran"],["IQ","Iraq"],["IE","Ireland"],["IL","Israel"],["IT","Italy"],["JM","Jamaica"],["JP","Japan"],["JO","Jordan"],["KZ","Kazakhstan"],["KE","Kenya"],["KI","Kiribati"],["KR","Korea"],["KW","Kuwait"],["KG","Kyrgyzstan"],["LA","Laos"],["LV","Latvia"],["LB","Lebanon"],["LS","Lesotho"],["LR","Liberia"],["LY","Libya"],["LI","Liechtenstein"],["LT","Lithuania"],["LU","Luxembourg"],["MO","Macau"],["MK","Macedonia"],["MG","Madagascar"],["MW","Malawi"],["MY","Malaysia"],["MV","Maldives"],["ML","Mali"],["MT","Malta"],["MH","Marshall Islands"],["MQ","Martinique"],["MR","Mauritania"],["MU","Mauritius"],["YT","Mayotte"],["MX","Mexico"],["FM","Micronesia"],["MD","Moldova"],["MC","Monaco"],["MN","Mongolia"],["MS","Montserrat"],["MA","Morocco"],["MZ","Mozambique"],["MM","Myanmar"],["NA","Namibia"],["NR","Nauru"],["NP","Nepal"],["NL","Netherlands"],["AN","Netherlands Antilles"],["NC","New Caledonia"],["NZ","New Zealand"],["NI","Nicaragua"],["NE","Niger"],["NG","Nigeria"],["NU","Niue"],["NF","Norfolk Island"],["KP","North Korea"],["XB","Northern Ireland"],["MP","Northern Mariana Isl."],["NO","Norway"],["OM","Oman"],["PK","Pakistan"],["PW","Palau"],["PA","Panama"],["PG","Papua New Guinea"],["PY","Paraguay"],["PE","Peru"],["PH","Philippines"],["PN","Pitcairn"],["PL","Poland"],["PT","Portugal"],["PR","Puerto Rico"],["QA","Qatar"],["RE","Reunion"],["RO","Romania"],["RU","Russia"],["RW","Rwanda"],["LC","Saint Lucia"],["SM","San Marino"],["ST","Sao Tome And Principe"],["SA","Saudi Arabia"],["WY","Scotland"],["SN","Senegal"],["SC","Seychelles"],["SL","Sierra Leone"],["SG","Singapore"],["SK","Slovak Republic"],["SI","Slovenia"],["SB","Solomon Islands"],["SO","Somalia"],["ZA","South Africa"],["GS","South Georgia"],["ES","Spain"],["LK","Sri Lanka"],["SH","St. Helena"],["KN","St. Kitts &amp; Nevis"],["PM","St. Pierre"],["VC","St. Vinc. &amp; The Grndns"],["SD","Sudan"],["SR","Suriname"],["SJ","Svlbrd &amp; Jn Myn Isl."],["SZ","Swaziland"],["SE","Sweden"],["CH","Switzerland"],["SY","Syria"],["TW","Taiwan"],["TJ","Tajikistan"],["TZ","Tanzania"],["TH","Thailand"],["TG","Togo"],["TK","Tokelau"],["TO","Tonga"],["TT","Trinidad And Tobago"],["TN","Tunisia"],["TR","Turkey"],["TM","Turkmenistan"],["TC","Turks And Caicos Isl."],["TV","Tuvalu"],["UM","U.S. Minor Outlying Isl."],["UG","Uganda"],["UA","Ukraine"],["AE","United Arab Emirates"],["GB","United Kingdom"],["US","United States"],["UY","Uruguay"],["UZ","Uzbekistan"],["VU","Vanuatu"],["VA","Vatican City State"],["VE","Venezuela"],["VN","Viet Nam"],["VG","Virgin Islands (British)"],["VI","Virgin Islands (U.S.)"],["WX","Wales"],["WF","Wallis &amp; Futuna Isl."],["EH","Western Sahara"],["WS","Western Samoa"],["YE","Yemen"],["YU","Yugoslavia"],["ZM","Zambia"],["ZW","Zimbabwe"]];var eventcategories=[["","Any"],["31","Attractions"],["163","Ballet & Dance"],["161","Cabaret"],["19","Classical Music"],["162","Comedy"],["32","Concerts"],["122","Consumer Exhibitions"],["111","Country"],["141","Cruises"],["112","Dance & Electronica"],["101","Dinner Shows & Restaurants"],["33","Exhibitions and events"],["131","Experiences"],["113","Festivals"],["164","For Kids"],["123","Galleries & Museums"],["53","Hotel Deals & Packages"],["145","Hotshots"],["114","Indie & Alternative"],["115","Jazz"],["116","Metal"],["152","Motor Sport"],["165","Musicals"],["166","Opera"],["124","Opera, Ballet & Dance"],["125","Orchestras & Recitals"],["132","Organisation Memberships"],["167","Plays"],["168","Production Show"],["11","Rock & Pop"],["35","Sightseeing"],["142","Sightseeing Tours"],["121","Special Events"],["127","Special Interest Tours"],["51","Special Offers"],["37","Sport"],["126","Talks"],["153","Tennis"],["18","Theater"],["104","Theme Parks"],["105","Tourist Attractions"],["117","Tours"],["999","Transfers"],["40","Travel"]];var propertytypes=[["","Any available"],["4","bed and breakfast"],["16","guest house limited service"],["20","hotel"],["22","lodge"],["30","resort"],["45","boutique"]];var propertytypesNew=[["","Any available"],["4","bed and breakfast"],["16","guest house limited service"],["18","resort"],["20","hotel"],["22","lodge"],["45","boutique"]];var locationtypes=[["","Any available"],["1","airport"],["2","beach"],["3","city"],["8","wildlife reserve"],["10","resort"],["23","countryside"]];var locationtypesNew=[["","Any available"],["1","airport"],["2","beach"],["3","city centre"],["8","wildlife reserve"],["10","resort"],["23","countryside"]];var hotelchains=[["","Any available"],["ERES-CLH","City Lodge Group"],["ERES-FHR","Fairmont Hotels &amp; Resorts"],["ERES-STO","Legacy Hotels &amp; Resorts"],["ERES-OEH","Orient Express"],["PRO-PTE","Protea"],["ERES-RDS","Relais Hotels"],["SUN-SSH","Tsogo Sun"],["ERES-SWD","Starwood Hotels"],["ERES-SUL","Sun International"],["ERES-TCL","Three Cities"],["ERES-ABE","&amp; Beyond"],["ERES-AIF","Africa In Focus"],["ERES-AHA","African Hotels & Adventures"],["ERES-APR","African Pride"],["ERES-AAN","An African Anthology"],["ERES-AMH","Amakhala The Heritage Collection"],["ERES-AZR","Azura Retreats"],["ERES-CLR","Classic Retreats"],["ERES-CST","Comfort Stay Hotels &amp; Accommodation"],["ERES-DLL","Daddy Long Legs"],["ERES-DHC","De Hoop Collection"],["ERES-EAD","Earthbound Destinations"],["ERES-EXT","Extraordinary Hotels"],["ERES-FRE","Forever Resorts"],["ERES-GUV","Guvon Hotels"],["ERES-HER","Heritage Resorts"],["ERES-HUH","Hunter Hotels"],["ERES-IND","Independent"],["ERES-IPL","Inspirational Places"],["ERES-IAF","Isibindi Africa"],["ERES-IIA","Islands In Africa"],["ERES-KIR","Kingfisher Resorts"],["ERES-LEL","Legend Lodges"],["ERES-LEH","Leisure Hotels"],["ERES-LRO","Lion Roars Safari &amp; Lodge"],["ERES-MAC","Mantis Collection"],["ERES-MOH","More Hotels"],["ERES-MVC","MV Communications"],["ERES-NAW","Nature Workshop"],["ERES-NIT","Nightsbridge"],["ERES-OAO","One &amp; Only"],["ERES-PEH","Peermont Hotels"],["ERES-RAR","Rani Resorts"],["ERES-RER","Rare Earth Retreats"],["ERES-247","Res24Seven"],["ERES-SSB","Sabi Sabi Private Game Reserve"],["ERES-SAF","Safarilands"],["ERES-SIA","Seasons In Africa"],["ERES-SIL","Signature Life"],["ERES-SOP","Southern Spoor"],["ERES-SUL","Sun International"],["ERES-SUS","Sunstays Luxury Accommodation"],["ERES-MAD","The Madikwe Collection"],["ERES-THO","The Thornybush Collection"],["ERES-TIN","Tintswalo Lodges Group"],["ERES-UHH","Urban Hip Hotels"],["ERES-VAL","Village &amp; Life"],["ERES-PCL","Portfolio Collection"],["ERES-OCL","Orange Collection"]];function RemoveAddErrorClass(element){if($.trim(element.val())==""){element.addClass("form-error");}
else{element.removeClass("form-error");}}
function getIP(json){_userIP=json.ip;}
function moveLogin(divName){var divHtml=$("#SelQuestion").html();if(divHtml){$("#SelQuestion").remove();$(divName).prepend('<div id="SelQuestion" style="display:block;">'+divHtml+'</div>');setVitalityLoginTriggers();simple_tooltip("span.info-tooltip","tooltip");}}
function setVitalityLoginTriggers(){if($("#ddl-option").length==0){$("#rad-option-vitality").click(function(){toggleOptions('on');setVisibleSelector();});$("#rad-option-vitality-login").click(function(){toggleOptions('on');});$("#rad-option-ebucks").click(function(){toggleOptions('on');});$("#rad-option-ebucks-login").click(function(){toggleOptions('on');});$("#rad-option-no").click(function(){toggleOptions('off');if(activeButton!=null){$("#window").dialog("open");activeButton.click();}});if($("#rad-option-vitality").is(':checked'))$("#rad-option-vitality").click();if($("#rad-option-vitality-login").is(':checked'))$("#rad-option-vitality-login").click();if($("#rad-option-ebucks").is(':checked'))$("#rad-option-ebucks").click();if($("#rad-option-ebucks-login").is(':checked'))$("#rad-option-ebucks-login").click();if($("#rad-option-no").is(':checked'))$("#rad-option-no").click();}
else{$("#ddl-option").change(function(){switch($("#ddl-option").val()){case"vitality":case"vitality-login":$("#vitality").show();$("#ebucks").hide();toggleOptions('on')
$("#ddl-option").removeClass("form-error");break;case"ebucks":case"ebucks-login":$("#vitality").hide();$("#ebucks").show();toggleOptions('on')
$("#ddl-option").removeClass("form-error");break;case"no":$("#vitality").hide();$("#ebucks").hide();toggleOptions('off')
$("#ddl-option").removeClass("form-error");if(activeButton!=null){$("#window").dialog("open");activeButton.click();}
break;default:$("#vitality").show();$("#ebucks").show();toggleOptions('all-off')
break;}});}}
function updateTotal(memberId){$(event.target).closest('ul').children().each(function(){$(this).removeClass('selected');});$(event.target).closest('li').addClass('selected');if($("#purpleDiscount_"+memberId).is(":checked")){$('input[name^="bankDiscount_'+memberId+'"]').prop('disabled',true);$('input[name^="bankDiscount_'+memberId+'"]').closest('div.benefit').addClass('disabled');}
else{var baseAllocation=parseInt($("#baseAllocation_"+memberId).attr("allocation"));var superAllocation=parseInt($("#superAllocation_"+memberId).attr("allocation"));if(baseAllocation>0||superAllocation>0){$("#TravelClassError").hide();$("input[id^='discovery_']").prop('disabled',false);$('input[name^="bankDiscount_'+memberId+'"]').prop('disabled',false);$('input[name^="bankDiscount_'+memberId+'"]').closest('div.benefit').removeClass('disabled');$("#ddlServiceClass").val(1);if(baseAllocation<1){$('input[id^="baseDiscount_'+memberId+'"]').prop('disabled',true);$("#baseBankDiscount_"+memberId).addClass("nousage");}
if(superAllocation<1){$('input[id^="superDiscount_'+memberId+'"]').prop('disabled',true);$("#superBankDiscount_"+memberId).addClass("nousage");}}}
calculateDiscountTotal(memberId);}
function calculateDiscountTotal(memberId){var sum=0;if($("#flatRateDiscounts_"+memberId).is(":visible")){sum=parseFloat($("#flatRateDiscount_"+memberId).siblings().text().replace('%','').trim());}
else{$("input:checked[name$='Discount_"+memberId+"']").each(function(){if($(this).prop('disabled')==false){var item_num=parseFloat($(this).siblings().text().replace('%','').trim());if(isNaN(item_num)){item_num=0;}
sum+=item_num;}});var displayBankWarning=false;$("input:checked[name^='bankDiscount_']").each(function(){if($(this).prop('disabled')==false){if($(this).parent().is(':visible')){displayBankWarning=true;}}});if(displayBankWarning){$("#BankWarning").show();}
else{$("#BankWarning").hide();}}
$('#totalPercentageDiscount_'+memberId).html(sum+'%');}
function displayStopOvers(){$("#div-stop-overs").show();if($("#flight-depart-to1")[0].length>0){$("#btn-display-depart-detail").show();}
else{$("#btn-display-depart-detail").hide();}
if($("#flight-depart-to2")[0].length>0){$("#btn-display-return-detail").show();}
else{$("#btn-display-return-detail").hide();}}
function hideStopOvers(){$("#div-stop-overs").hide();}
function showDepartStopOver(){$("#div-flight-depart-detail").show();$("#div-flight-depart-summary").hide();if(!$("#div-flight-depart-detail").is(":visible")){$("#flight-depart-to2").prop("disabled",false);}
else{$("#flight-depart-to2").prop("disabled",true);}}
function hideDepartStopOver(){$("#div-flight-depart-detail").hide();$("#div-flight-depart-summary").show();if(!$("#div-flight-depart-detail").is(":visible")){$("#flight-depart-to2").prop("disabled",false);}
else{$("#flight-depart-to2").prop("disabled",true);}}
function showReturnStopOver(){$("#div-flight-return-detail").show();$("#div-flight-return-summary").hide();if(!$("#div-flight-depart-detail").is(":visible")){$("#flight-depart-to2").prop("disabled",false);}
else{$("#flight-depart-to2").prop("disabled",true);}}
function hideReturnStopOver(){$("#div-flight-return-detail").hide();$("#div-flight-return-summary").show();}
function updateStopOver(){$("#flight-arrive-from1").val($("#flight-depart-to1").val());$("#flight-depart-to2").val($("#flight-depart-to1").val());$("#flight-arrive-from2").val($("#flight-depart-to1").val());getUniqueDeparturesAjax($("#flight-depart-to1").val(),4,"stopover",$("#flight-arrive-to1").val());}
function updateReturnStopOver(){$("#flight-arrive-from1").val($("#flight-depart-to2").val());$("#flight-depart-to1").val($("#flight-depart-to2").val());$("#flight-arrive-from2").val($("#flight-depart-to2").val());}
function updateStopOverDestination(){var arrivalAirport=$("#ddlArrivalAirport").val();getUniqueDeparturesAjax($("#ddlArrivalAirport").val(),4,"international");$("#flight-arrive-to1").val(arrivalAirport);$("#flight-depart-to").val(arrivalAirport);$("#flight-return-from").val(arrivalAirport);$("#flight-return-from").prop("disabled",false);$("#flight-return-to").prop("disabled",false);}
function updateStopOverDeparture(){var departureAirport=$("#ddlDepartureAirport").val();$("#flight-depart-from1").val(departureAirport);$("#flight-arrive-to2").val(departureAirport);$("#flight-depart-from").val(departureAirport);$("#flight-return-to").val(departureAirport);}
jQuery(document).ready(function(){$("input[format='true']").change(function(){RemoveAddErrorClass($(this));});$('[id^= member_]').click(function(){var entityNo=$(this).find('[id^="discovery_"]').attr("id").split("_")[1];if($(this).find('[id^="discovery_"]').is(":checked")){$(this).find('.profile').addClass('active');if(flatRateActivated||$("#availableAllocation_"+entityNo).val()==0||$("#standardDiscounts_"+entityNo).length==0){$("#standardDiscounts_"+entityNo).hide();$("#flatRateDiscounts_"+entityNo).show();$("#flatRateDiscount_"+entityNo).prop("disabled",false);}
else{var segmentCount=$("input[name=flight-type]:checked").attr("segments");$("#standardDiscounts_"+entityNo).show();$("#flatRateDiscounts_"+entityNo).hide();$("#flatRateDiscount_"+entityNo).prop("disabled",true);}
calculateDiscountTotal(entityNo);}
else{$(this).find('.profile').removeClass('active');$("#flatRateDiscounts_"+entityNo).hide();$("#standardDiscounts_"+entityNo).hide();}});if(vitality){dateOptions2.minDate='+2d';if(fcas){departAirportChanged();$("#flight-depart-date").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){if(fcas){$("#flight-depart-date1").datepicker('setDate',dateText);$("#flight-return-date").datepicker('option','minDate',dateText);$("#flight-depart-date2").datepicker('option','minDate',dateText);$("#flight-arrive-date1").datepicker('option','minDate',dateText);$("#flight-arrive-date2").datepicker('option','minDate',dateText);}
if(vitality){var currentDate=new Date();var selectedDate=new Date(dateText);var minDate=currentDate.addDays(vifd);var checkedMembers=$("#vitality-travellers-table").find("input[id^='discovery_']:checked");var flatRateControl="FlatRateWarning";if($("input[name^='bankDiscount_']").length)
{flatRateControl="FlatRateWarningwithBank";}
if(selectedDate<minDate){$("#"+flatRateControl).show();flatRateActivated=true;$.each(checkedMembers,function(){var entityNo=this.id.split("_")[1];$("#standardDiscounts_"+entityNo).hide();$("#standardDiscounts_"+entityNo).children('input').prop('disabled',true);$("#flatRateDiscount_"+entityNo).prop('disabled',false);$("#flatRateDiscounts_"+entityNo).show();calculateDiscountTotal(entityNo);});}
else{$("#"+flatRateControl).hide();flatRateActivated=false;$.each(checkedMembers,function(){var entityNo=this.id.split("_")[1];if($("#standardDiscounts_"+entityNo).length&&$("#availableAllocation_"+entityNo).val()>0){$("#flatRateDiscounts_"+entityNo).hide();$("#flatRateDiscount_"+entityNo).prop('disabled',true);if($("#discovery_"+entityNo).is(":checked")){$("#standardDiscounts_"+entityNo).show();$("#standardDiscounts_"+entityNo).children('input').prop('disabled',false);calculateDiscountTotal(entityNo);}}});}}}}));$("#flight-depart-date1").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){if(fcas){$("#flight-depart-date").datepicker('setDate',dateText);$("#flight-depart-date2").datepicker('option','minDate',dateText);$("#flight-arrive-date1").datepicker('option','minDate',dateText);$("#flight-arrive-date2").datepicker('option','minDate',dateText);}
if(vitality){var currentDate=new Date();var selectedDate=new Date(dateText);var minDate=currentDate.addDays(vifd);var checkedMembers=$("#vitality-travellers-table").find("input[id^='discovery_']:checked");var flatRateControl="FlatRateWarning";if($("input[name^='bankDiscount_']").length)
{flatRateControl="FlatRateWarningwithBank";}
if(selectedDate<minDate){$("#"+flatRateControl).show();flatRateActivated=true;$.each(checkedMembers,function(){var entityNo=this.id.split("_")[1];$("#standardDiscounts_"+entityNo).hide();$("#standardDiscounts_"+entityNo).children('input').prop('disabled',true);$("#flatRateDiscount_"+entityNo).prop('disabled',false);$("#flatRateDiscounts_"+entityNo).show();calculateDiscountTotal(entityNo);});}
else{$("#"+flatRateControl).hide();flatRateActivated=false;$.each(checkedMembers,function(){var entityNo=this.id.split("_")[1];if($("#standardDiscounts_"+entityNo).length&&$("#availableAllocation_"+entityNo).val()>0){$("#flatRateDiscounts_"+entityNo).hide();$("#flatRateDiscount_"+entityNo).prop('disabled',true);if($("#discovery_"+entityNo).is(":checked")){$("#standardDiscounts_"+entityNo).show();$("#standardDiscounts_"+entityNo).children('input').prop('disabled',false);calculateDiscountTotal(entityNo);}}});}}}}));$("#flight-arrive-date2").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){if(fcas){$("#flight-return-date").datepicker('setDate',dateText);$("#flight-depart-date1").datepicker('option','maxDate',dateText);$("#flight-arrive-date1").datepicker('option','maxDate',dateText);$("#flight-depart-date2").datepicker('option','maxDate',dateText);}}}));$("#flight-return-date").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){if(fcas){$("#flight-arrive-date2").datepicker('setDate',dateText);$("#flight-depart-date2").datepicker('option','maxDate',dateText);$("#flight-arrive-date1").datepicker('option','maxDate',dateText);$("#flight-depart-date1").datepicker('option','maxDate',dateText);}}}));$("#flight-arrive-date1").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){$("#flight-depart-date2").datepicker('setDate',dateText);$("#flight-depart-date2").datepicker('option','minDate',dateText);$("#flight-return-date").datepicker('option','minDate',dateText);$("#flight-depart-date1").datepicker('option','maxDate',dateText);}}));$("#flight-depart-date2").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){if($("#flight-arrive-date1").datepicker('getDate')>dateText){$("#flight-arrive-date1").datepicker('setDate',dateText);}
$("#flight-arrive-date2").datepicker('option','minDate',dateText);$("#flight-arrive-date1").datepicker('option','maxDate',dateText);$("#flight-depart-date").datepicker('option','maxDate',dateText);}}));$("#flight-depart-date1").datepicker(dateOptions);$("#flight-depart-date1").datepicker('setDate','+6w');$("#flight-depart-date2").datepicker(dateOptions);$("#flight-depart-date2").datepicker('setDate','+6w');$("#flight-arrive-date1").datepicker(dateOptions);$("#flight-arrive-date1").datepicker('setDate','+6w');$("#flight-arrive-date2").datepicker(dateOptions);$("#flight-arrive-date2").datepicker('setDate','+6w');$("#flight-depart-date").datepicker('setDate','+6w');$("#flight-return-date").datepicker('setDate','+6w');}}
if(!vitality){setVitalityLoginTriggers();}
if(jtyp){$("#journey-type").children().each(function(){var r=this.id.replace("li","rad");$(this).click(function(){$("#journey-type").children().each(function(){$(this).attr('class','');$('input:radio[name=journey-type]').prop('checked',false);});$(this).attr('class','selected');$("input:radio[id="+r+"]").prop('checked',true);setVisibleSelector();toggleDisplay("#"+r);toggleOptions('none');$(".action").attr('style','');$(".btn-expand").attr('style','');});});}
if(false&&((fsel&&fshw)||(fasel&&fashw)||(fcsel&&fcshw)||(facsel&&facshw))){$("#window").dialog("open");$.ajax({cache:false,success:DataLoaded,url:"/flightselectorinfo?segmentTypeId="+_segmentTypeId});}
if(((fsel&&fshw)||(fasel&&fashw)||(fcsel&&fcshw)||(facsel&&facshw))){$("#window").dialog("open");DataLoadAjax();}
if((csel&&cshw)||(fcsel&&fcshw)||(facsel&&facshw)){if(csel&&cshw){$("#car-pick-up-time").children().remove().end();$("#car-drop-off-time").children().remove().end();}
if(fasel&&fashw){$("#flight-acc-from-time").children().remove().end();$("#flight-acc-to-time").children().remove().end();$("#flight-acc-from-time").append($('<option selected="selected"></option>').val('').html('Any'));$("#flight-acc-to-time").append($('<option selected="selected"></option>').val('').html('Any'));}
if(fcsel&&fcshw){$("#flight-car-from-time").children().remove().end();$("#flight-car-to-time").children().remove().end();$("#flight-car-from-time").append($('<option selected="selected"></option>').val('').html('Any'));$("#flight-car-to-time").append($('<option selected="selected"></option>').val('').html('Any'));}
if(facsel&&facshw){$("#flight-acc-car-from-time").children().remove().end();$("#flight-acc-car-to-time").children().remove().end();$("#flight-acc-car-from-time").append($('<option selected="selected"></option>').val('').html('Any'));$("#flight-acc-car-to-time").append($('<option selected="selected"></option>').val('').html('Any'));}
var ivl=30;var put=new Date();put.setHours(0,0,0,0);for(i=0;i<48;i++){if(csel&&cshw&&put.getMinutes()==0){var opt='<option></option>';if(put.getHours()==12&&put.getMinutes()==0){opt='<option selected="selected"></option>';}
$("#car-pick-up-time").append($(opt).val(put.toTimeString().substr(0,8)).html(put.toTimeString().substr(0,5)));$("#car-drop-off-time").append($(opt).val(put.toTimeString().substr(0,8)).html(put.toTimeString().substr(0,5)));}
if(fasel&&fashw){var opt='<option></option>';$("#flight-acc-from-time").append($(opt).val(put.toTimeString().substr(0,8)).html(put.toTimeString().substr(0,5)));$("#flight-acc-to-time").append($(opt).val(put.toTimeString().substr(0,8)).html(put.toTimeString().substr(0,5)));}
if(fcsel&&fcshw){var opt='<option></option>';$("#flight-car-from-time").append($(opt).val(put.toTimeString().substr(0,8)).html(put.toTimeString().substr(0,5)));$("#flight-car-to-time").append($(opt).val(put.toTimeString().substr(0,8)).html(put.toTimeString().substr(0,5)));}
if(facsel&&facshw){var opt='<option></option>';$("#flight-acc-car-from-time").append($(opt).val(put.toTimeString().substr(0,8)).html(put.toTimeString().substr(0,5)));$("#flight-acc-car-to-time").append($(opt).val(put.toTimeString().substr(0,8)).html(put.toTimeString().substr(0,5)));}
put.setMinutes(put.getMinutes()+ivl,0,0);}}
if(fsel&&fshw){if(!vitality){$("#paxholder").show();$("#vitality-travellers-table").hide();}else{var members=$("#vitality-travellers-table").find("div[id^='member_']");if(!members||members.length==0){showError("Oops! It looks like you're not logged in anymore.",500,500,"ce","/discovery/account/signin");return;}}
$("#BargainBrowza").children().each(function(){var r="#"+this.id.replace("li","rad");$(this).click(function(){removeBargainClass();$(this).addClass("selected");$(r).attr('checked','checked');});});$("#flight-type").children().each(function(){var r="#"+this.id.replace("li","rad");var segmentCount=2;var airportType="flight";$(this).click(function(){removeFlightTypeClass();$(this).addClass("selected");$(r).attr('checked','checked');if($(r).val()=="OW"){$("#div-ret").hide();$("#div-dep").show();segmentCount=1;}
else{$("#div-ret").show();$("#div-dep").show();}
if($(r).val()=="MC"){if(!fcas){$("#flight-segments-first,#flight-segments-first-2").hide();$("#flight-segments-second").hide();$("#flight-segments-multi").show();segmentCount=3;}
else{var arrivalAirport=$("#ddlArrivalAirport").val();if(arrivalAirport.length>0){displayStopOvers();}
else{hideStopOvers();}
$("#div-ret").hide();$("#div-dep").hide();}}
else{$("#flight-segments-multi").hide();$("#flight-segments-first,#flight-segments-first-2").show();$("#flight-segments-second").show();hideStopOvers();}
if(vitality){validateDiscoveryUsage(segmentCount);}
resetModifySearchHeight($(r).val());});});$("#ddlArrivalAirport").click(function(){$(this).removeClass("form-error");});$("#fromDate").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){$("#toDate").datepicker('option','minDate',dateText);RemoveAddErrorClass($(this));if(vitality&&fint){var currentDate=new Date();var selectedDate=new Date(dateText);var minDate=currentDate.addDays(vifd);var checkedMembers=$("#vitality-travellers-table").find("input[id^='discovery_']:checked");var flatRateControl="FlatRateWarning";if($("input[name^='bankDiscount_']").length){flatRateControl="FlatRateWarningwithBank";}
if(selectedDate<minDate){$("#"+flatRateControl).show();flatRateActivated=true;$.each(checkedMembers,function(){var entityNo=this.id.split("_")[1];$("#standardDiscounts_"+entityNo).hide();$("#standardDiscounts_"+entityNo).children('input').prop('disabled',true);$("#flatRateDiscount_"+entityNo).prop('disabled',false);$("#flatRateDiscounts_"+entityNo).show();calculateDiscountTotal(entityNo);});}
else{$("#"+flatRateControl).hide();flatRateActivated=false;$.each(checkedMembers,function(){var entityNo=this.id.split("_")[1];if($("#standardDiscounts_"+entityNo&&$("#availableAllocation_"+entityNo).val()>0).length){$("#flatRateDiscounts_"+entityNo).hide();$("#flatRateDiscount_"+entityNo).prop('disabled',true);if($("#discovery_"+entityNo).is(":checked")){$("#standardDiscounts_"+entityNo).show();$("#standardDiscounts_"+entityNo).children('input').prop('disabled',false);calculateDiscountTotal(entityNo);}}});}}}}));$("#toDate").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){if(fcas){$("#flight-arrive-date2").datepicker('setDate',dateText);$("#flight-return-date").datepicker('setDate',dateText);$("#flight-depart-date2").datepicker('option','maxDate',dateText);$("#flight-arrive-date1").datepicker('option','maxDate',dateText);}}}));$("#fromDate").datepicker('setDate','+0d');$("#toDate").datepicker(dateOptions);$("#toDate").datepicker('setDate','+0d');if(fcas)
{$("#fromDate").datepicker('setDate','+6w');$("#toDate").datepicker('setDate','+6w');if(!$('input[id^=flatRateDiscount_]').length){$("#fromDate").datepicker('option','minDate',$("#fromDate").datepicker("getDate"));$("#toDate").datepicker('option','minDate',$("#fromDate").datepicker("getDate"));$("#flight-depart-date").datepicker('option','minDate',$("#fromDate").datepicker("getDate"));$("#flight-return-date").datepicker('option','minDate',$("#fromDate").datepicker("getDate"));$("#flight-depart-date1").datepicker('option','minDate',$("#fromDate").datepicker("getDate"));$("#flight-arrive-date1").datepicker('option','minDate',$("#fromDate").datepicker("getDate"));$("#flight-depart-date2").datepicker('option','minDate',$("#fromDate").datepicker("getDate"));$("#flight-arrive-date2").datepicker('option','minDate',$("#fromDate").datepicker("getDate"));$("#FlatRateWarningBankOnly").show();}}
if(!fmul){$("#flight-multi-date1").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){$("#flight-multi-date2").datepicker('option','minDate',dateText);$("#flight-multi-date3").datepicker('option','minDate',dateText);$("#flight-multi-date4").datepicker('option','minDate',dateText);$("#flight-multi-date5").datepicker('option','minDate',dateText);}}));$("#flight-multi-date1").datepicker('setDate','+0d');$("#flight-multi-date2").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){$("#flight-multi-date3").datepicker('option','minDate',dateText);$("#flight-multi-date4").datepicker('option','minDate',dateText);$("#flight-multi-date5").datepicker('option','minDate',dateText);$("#flight-multi-date1").datepicker('option','maxDate',dateText);}}));$("#flight-multi-date2").datepicker('setDate','+0d');$("#flight-multi-date3").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){$("#flight-multi-date4").datepicker('option','minDate',dateText);$("#flight-multi-date5").datepicker('option','minDate',dateText);$("#flight-multi-date2").datepicker('option','maxDate',dateText);}}));$("#flight-multi-date3").datepicker('setDate','+0d');$("#flight-multi-date4").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){$("#flight-multi-date5").datepicker('option','minDate',dateText);$("#flight-multi-date3").datepicker('option','maxDate',dateText);}}));$("#flight-multi-date4").datepicker('setDate','+0d');$("#flight-multi-date5").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){$("#flight-multi-date4").datepicker('option','maxDate',dateText);}}));$("#flight-multi-date5").datepicker('setDate','+0d');$("#flight-multi-add").click(function(){if(!$("#div-multi-from3").is(":visible")){$("#div-multi-from3").show();$("#div-multi-to3").show();$("#div-multi-date3").show();changeModifySearchHeight(70);validateDiscoveryUsage(3);}
else if(!$('#div-multi-from4').is(':visible')){$('#div-multi-from4').show();$('#div-multi-to4').show();$('#div-multi-date4').show();if(frdt==3){$("#flight-multi-add").hide();}
changeModifySearchHeight(70);validateDiscoveryUsage(4);}
else if(!$('#div-multi-from5').is(':visible')){$('#div-multi-from5').show();$('#div-multi-to5').show();$('#div-multi-date5').show();$("#flight-multi-add").hide();changeModifySearchHeight(70);validateDiscoveryUsage(5);}});$("#flight-multi3-remove").click(function(){if($("#div-multi-from5").is(":visible")){$("#flight-multi-from3").val($("#flight-multi-from4").val());$("#flight-multi-from3").change();$("#flight-multi-to3").val($("#flight-multi-to4").val());$("#flight-multi-date3").val($("#flight-multi-date4").val());$("#flight-multi-from4").val($("#flight-multi-from5").val());$("#flight-multi-from4").change();$("#flight-multi-to4").val($("#flight-multi-to5").val());$("#flight-multi-date4").val($("#flight-multi-date5").val());$("#div-multi-from5").hide();$("#div-multi-to5").hide();$("#div-multi-date5").hide();changeModifySearchHeight(-70);validateDiscoveryUsage(4);}
else if($("#div-multi-from4").is(":visible")){$("#flight-multi-from3").val($("#flight-multi-from4").val());$("#flight-multi-from3").change();$("#flight-multi-to3").val($("#flight-multi-to4").val());$("#flight-multi-date3").val($("#flight-multi-date4").val());$("#div-multi-from4").hide();$("#div-multi-to4").hide();$("#div-multi-date4").hide();changeModifySearchHeight(-70);validateDiscoveryUsage(3);}
else{$("#div-multi-from3").hide();$("#div-multi-to3").hide();$("#div-multi-date3").hide();changeModifySearchHeight(-70);validateDiscoveryUsage(2);}
$("#flight-multi-add").show();});$("#flight-multi4-remove").click(function(){if($("#div-multi-from5").is(":visible")){$("#flight-multi-from4").val($("#flight-multi-from5").val());$("#flight-multi-from4").change();$("#flight-multi-to4").val($("#flight-multi-to5").val());$("#flight-multi-date4").val($("#flight-multi-date5").val());$("#div-multi-from5").hide();$("#div-multi-to5").hide();$("#div-multi-date5").hide();changeModifySearchHeight(-70);validateDiscoveryUsage(4);}
else{$("#div-multi-from4").hide();$("#div-multi-to4").hide();$("#div-multi-date4").hide();changeModifySearchHeight(-70);validateDiscoveryUsage(3);}
$("#flight-multi-add").show();});$("#flight-multi5-remove").click(function(){$("#div-multi-from5").hide();$("#div-multi-to5").hide();$("#div-multi-date5").hide();$("#flight-multi-add").show();changeModifySearchHeight(-70);validateDiscoveryUsage(4);});}}
if(csel&&cshw){$("#car-pnr").bind("change",function(){changePNR('car-pnr');});$("#car-pick-up-date").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){$("#car-drop-off-date").datepicker('option','minDate',dateText);RemoveAddErrorClass($(this));}}));$("#car-pick-up-date").datepicker('setDate','+1d');$("#car-drop-off-date").datepicker(dateOptions);$("#car-drop-off-date").datepicker('setDate','+3d');if(crdt==4){var ajaxUrl="/carselector?useOJLocationCode="+cuoj;if(window.location.protocol=="https:"||document.location.protocol=="https:")
{ajaxUrl="/carselectorSSL?useOJLocationCode="+cuoj;}
$("#window").dialog("open");$.ajax({cache:false,url:ajaxUrl}).done(function(carbranches){$("#car-pick-up").children().remove().end();$("#car-drop-off").children().remove().end();var group="";$.each(carbranches,function(i){if(carbranches[i][2]=="g"){$("#car-pick-up").append("<optgroup label='"+carbranches[i][1]+"'>");$("#car-drop-off").append("<optgroup label='"+carbranches[i][1]+"'>");group=carbranches[i][1];}
else{if(group==""){$("#car-pick-up").append($(carbranches[i][2]=="os"?'<option selected="selected"></option>':'<option></option>').val(carbranches[i][0]).html(carbranches[i][1]));$("#car-drop-off").append($(carbranches[i][2]=="os"?'<option selected="selected"></option>':'<option></option>').val(carbranches[i][0]).html(carbranches[i][1]));}
else{$(carbranches[i][2]=="os"?'<option selected="selected"></option>':'<option></option>').val(carbranches[i][0]).html(carbranches[i][1]).appendTo($("#car-pick-up").children("optgroup:last"));$(carbranches[i][2]=="os"?'<option selected="selected"></option>':'<option></option>').val(carbranches[i][0]).html(carbranches[i][1]).appendTo($("#car-drop-off").children("optgroup:last"));}}});$("#window").dialog("close");});}
else{$("#window").dialog("open");$.ajax({cache:false,url:"/carselectorinfo"}).done(function(branches){$("#car-pick-up").children().remove().end();$("#car-drop-off").children().remove().end();$.each(branches,function(branch,location){$("#car-pick-up").append($('<option></option>').val(branch).html(location));$("#car-drop-off").append($('<option></option>').val(branch).html(location));});$("#window").dialog("close");});}
$("#car-pick-up").bind("change",function(){$("#car-drop-off").val($("#car-pick-up").val());});$("#car-pick-up").click(function(){$(this).removeClass("form-error");});$("#car-drop-off").click(function(){$(this).removeClass("form-error");});}
if(asel&&ashw){$("#acc-pnr").bind("change",function(){changePNR('acc-pnr');});if(ardt==2){$("#window").dialog("open");$.ajax({cache:false,url:"/accselectorinfo",success:function(data){$("#acc-city").children().remove().end();$("#acc-type").children().remove().end();$.each(data.Cities,function(index,city){$("#acc-city").append($('<option></option>').val(city.Code).html(city.Name));});$.each(data.Types,function(index,type){$("#acc-type").append($('<option></option>').val(type.Code).html(type.Name));});}}).done(function(){$("#window").dialog("close");});}
else{$("#acc-dest").change(function(){if($.trim($("#acc-dest").val())==""){$("#acc-dest-code").val("");}});var ajaxUrl="/selectordestinationsheirarchy";if(window.location.protocol=="https:"||document.location.protocol=="https:")
{ajaxUrl="/selectordestinationsheirarchyssl";}
$("#acc-dest").hierarchy({delay:0,minLength:3,source:function(request,response){$.ajax({cache:false,url:ajaxUrl,dataType:"json",data:{type:4,filter:request.term},success:function(data){response($.map(data,function(item){return{value:item.Label,dest:item.OJLocationCode,hotel:item.OJHotelCode}}));}})},select:function(event,ui){$("#acc-dest").val(ui.item.value);$("#acc-dest").removeClass("form-error")
$("#acc-dest-code").val(ui.item.dest);$("#acc-hotel-code").val(ui.item.hotel);return false;},close:function(event,ui){if($("input[name='journey-type']:checked").attr("id")=="rad-acc"){var hiddenFields=[]
hiddenFields.push({elementId:"acc-dest-code",value:"",highlightElementId:"acc-dest"})
if(!validateHiddenFormFields(hiddenFields)){val=$("#acc-dest").val();$("#acc-dest").hierarchy("search",val);$("#acc-dest").focus();return false;}}}});$.each(countries,function(i){$("#acc-cor").append($(countries[i][0]=="ZA"?'<option selected="selected"></option>':'<option></option>').val(countries[i][0]).html(countries[i][1]));});$("#acc-rooms").bind("change",function(){switch($(this).val()){case'2':$("#div-acc-room2").show();$("#div-acc-room3").hide();$("#acc-room3-chd").val("0");$("#div-acc-chd-room3").hide();$("#div-acc-room4").hide();$("#acc-room4-chd").val("0");$("#div-acc-chd-room4").hide();$("#div-acc-room5").hide();$("#acc-room5-chd").val("0");$("#div-acc-chd-room5").hide();$("#div-acc-room6").hide();$("#acc-room6-chd").val("0");$("#div-acc-chd-room6").hide();$("#div-acc-room7").hide();$("#acc-room7-chd").val("0");$("#div-acc-chd-room7").hide();$("#div-acc-room8").hide();$("#acc-room8-chd").val("0");$("#div-acc-chd-room8").hide();$("#div-acc-room9").hide();$("#acc-room9-chd").val("0");$("#div-acc-chd-room9").hide();break;case'3':$("#div-acc-room2").show();$("#div-acc-room3").show();$("#div-acc-room4").hide();$("#acc-room4-chd").val("0");$("#div-acc-chd-room4").hide();$("#div-acc-room5").hide();$("#acc-room5-chd").val("0");$("#div-acc-chd-room5").hide();$("#div-acc-room6").hide();$("#acc-room6-chd").val("0");$("#div-acc-chd-room6").hide();$("#div-acc-room7").hide();$("#acc-room7-chd").val("0");$("#div-acc-chd-room7").hide();$("#div-acc-room8").hide();$("#acc-room8-chd").val("0");$("#div-acc-chd-room8").hide();$("#div-acc-room9").hide();$("#acc-room9-chd").val("0");$("#div-acc-chd-room9").hide();break;case'4':$("#div-acc-room2").show();$("#div-acc-room3").show();$("#div-acc-room4").show();$("#div-acc-room5").hide();$("#acc-room5-chd").val("0");$("#div-acc-chd-room5").hide();$("#div-acc-room6").hide();$("#acc-room6-chd").val("0");$("#div-acc-chd-room6").hide();$("#div-acc-room7").hide();$("#acc-room7-chd").val("0");$("#div-acc-chd-room7").hide();$("#div-acc-room8").hide();$("#acc-room8-chd").val("0");$("#div-acc-chd-room8").hide();$("#div-acc-room9").hide();$("#acc-room9-chd").val("0");$("#div-acc-chd-room9").hide();break;case'5':$("#div-acc-room2").show();$("#div-acc-room3").show();$("#div-acc-room4").show();$("#div-acc-room5").show();$("#div-acc-room6").hide();$("#acc-room6-chd").val("0");$("#div-acc-chd-room6").hide();$("#div-acc-room7").hide();$("#acc-room7-chd").val("0");$("#div-acc-chd-room7").hide();$("#div-acc-room8").hide();$("#acc-room8-chd").val("0");$("#div-acc-chd-room8").hide();$("#div-acc-room9").hide();$("#acc-room9-chd").val("0");$("#div-acc-chd-room9").hide();break;case'6':$("#div-acc-room2").show();$("#div-acc-room3").show();$("#div-acc-room4").show();$("#div-acc-room5").show();$("#div-acc-room6").show();$("#div-acc-room7").hide();$("#acc-room7-chd").val("0");$("#div-acc-chd-room7").hide();$("#div-acc-room8").hide();$("#acc-room8-chd").val("0");$("#div-acc-chd-room8").hide();$("#div-acc-room9").hide();$("#acc-room9-chd").val("0");$("#div-acc-chd-room9").hide();break;case'7':$("#div-acc-room2").show();$("#div-acc-room3").show();$("#div-acc-room4").show();$("#div-acc-room5").show();$("#div-acc-room6").show();$("#div-acc-room7").show();$("#div-acc-room8").hide();$("#acc-room8-chd").val("0");$("#div-acc-chd-room8").hide();$("#div-acc-room9").hide();$("#acc-room9-chd").val("0");$("#div-acc-chd-room9").hide();break;case'8':$("#div-acc-room2").show();$("#div-acc-room3").show();$("#div-acc-room4").show();$("#div-acc-room5").show();$("#div-acc-room6").show();$("#div-acc-room7").show();$("#div-acc-room8").show();$("#div-acc-room9").hide();$("#acc-room9-chd").val("0");$("#div-acc-chd-room9").hide();break;case'9':$("#div-acc-room2").show();$("#div-acc-room3").show();$("#div-acc-room4").show();$("#div-acc-room5").show();$("#div-acc-room6").show();$("#div-acc-room7").show();$("#div-acc-room8").show();$("#div-acc-room9").show();break;default:$("#div-acc-room2").hide();$("#acc-room2-chd").val("0");$("#div-acc-chd-room2").hide();$("#div-acc-room3").hide();$("#acc-room3-chd").val("0");$("#div-acc-chd-room3").hide();$("#div-acc-room4").hide();$("#acc-room4-chd").val("0");$("#div-acc-chd-room4").hide();$("#div-acc-room5").hide();$("#acc-room5-chd").val("0");$("#div-acc-chd-room5").hide();$("#div-acc-room6").hide();$("#acc-room6-chd").val("0");$("#div-acc-chd-room6").hide();$("#div-acc-room7").hide();$("#acc-room7-chd").val("0");$("#div-acc-chd-room7").hide();$("#div-acc-room8").hide();$("#acc-room8-chd").val("0");$("#div-acc-chd-room8").hide();$("#div-acc-room9").hide();$("#acc-room9-chd").val("0");$("#div-acc-chd-room9").hide();break;}});$("#acc-room1-chd").bind("change",function(){if($("#acc-room1-chd").val()=="0"&&$("#acc-room2-chd").val()=="0"&&$("#acc-room3-chd").val()=="0"&&$("#acc-room4-chd").val()=="0"&&$("#acc-room5-chd").val()=="0"&&$("#acc-room6-chd").val()=="0"&&$("#acc-room7-chd").val()=="0"&&$("#acc-room8-chd").val()=="0"&&$("#acc-room9-chd").val()=="0"){$(".div-acc-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-acc-chd-room1").hide();}else{$(".div-acc-chd-rooms").show();$("#div-acc-chd-room1").show();for(var i=1;i<=5;i++){var s="#div-acc-chd"+i+"-room1";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#acc-room2-chd").bind("change",function(){if($("#acc-room1-chd").val()=="0"&&$("#acc-room2-chd").val()=="0"&&$("#acc-room3-chd").val()=="0"&&$("#acc-room4-chd").val()=="0"&&$("#acc-room5-chd").val()=="0"&&$("#acc-room6-chd").val()=="0"&&$("#acc-room7-chd").val()=="0"&&$("#acc-room8-chd").val()=="0"&&$("#acc-room9-chd").val()=="0"){$(".div-acc-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-acc-chd-room2").hide();}else{$(".div-acc-chd-rooms").show();$("#div-acc-chd-room2").show();for(var i=1;i<=5;i++){var s="#div-acc-chd"+i+"-room2";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#acc-room3-chd").bind("change",function(){if($("#acc-room1-chd").val()=="0"&&$("#acc-room2-chd").val()=="0"&&$("#acc-room3-chd").val()=="0"&&$("#acc-room4-chd").val()=="0"&&$("#acc-room5-chd").val()=="0"&&$("#acc-room6-chd").val()=="0"&&$("#acc-room7-chd").val()=="0"&&$("#acc-room8-chd").val()=="0"&&$("#acc-room9-chd").val()=="0"){$(".div-acc-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-acc-chd-room3").hide();}else{$(".div-acc-chd-rooms").show();$("#div-acc-chd-room3").show();for(var i=1;i<=5;i++){var s="#div-acc-chd"+i+"-room3";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#acc-room4-chd").bind("change",function(){if($("#acc-room1-chd").val()=="0"&&$("#acc-room2-chd").val()=="0"&&$("#acc-room3-chd").val()=="0"&&$("#acc-room4-chd").val()=="0"&&$("#acc-room5-chd").val()=="0"&&$("#acc-room6-chd").val()=="0"&&$("#acc-room7-chd").val()=="0"&&$("#acc-room8-chd").val()=="0"&&$("#acc-room9-chd").val()=="0"){$(".div-acc-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-acc-chd-room4").hide();}else{$(".div-acc-chd-rooms").show();$("#div-acc-chd-room4").show();for(var i=1;i<=5;i++){var s="#div-acc-chd"+i+"-room4";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#acc-room5-chd").bind("change",function(){if($("#acc-room1-chd").val()=="0"&&$("#acc-room2-chd").val()=="0"&&$("#acc-room3-chd").val()=="0"&&$("#acc-room4-chd").val()=="0"&&$("#acc-room5-chd").val()=="0"&&$("#acc-room6-chd").val()=="0"&&$("#acc-room7-chd").val()=="0"&&$("#acc-room8-chd").val()=="0"&&$("#acc-room9-chd").val()=="0"){$(".div-acc-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-acc-chd-room5").hide();}else{$(".div-acc-chd-rooms").show();$("#div-acc-chd-room5").show();for(var i=1;i<=5;i++){var s="#div-acc-chd"+i+"-room5";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#acc-room6-chd").bind("change",function(){if($("#acc-room1-chd").val()=="0"&&$("#acc-room2-chd").val()=="0"&&$("#acc-room3-chd").val()=="0"&&$("#acc-room4-chd").val()=="0"&&$("#acc-room5-chd").val()=="0"&&$("#acc-room6-chd").val()=="0"&&$("#acc-room7-chd").val()=="0"&&$("#acc-room8-chd").val()=="0"&&$("#acc-room9-chd").val()=="0"){$(".div-acc-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-acc-chd-room6").hide();}else{$(".div-acc-chd-rooms").show();$("#div-acc-chd-room6").show();for(var i=1;i<=5;i++){var s="#div-acc-chd"+i+"-room6";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#acc-room7-chd").bind("change",function(){if($("#acc-room1-chd").val()=="0"&&$("#acc-room2-chd").val()=="0"&&$("#acc-room3-chd").val()=="0"&&$("#acc-room4-chd").val()=="0"&&$("#acc-room5-chd").val()=="0"&&$("#acc-room6-chd").val()=="0"&&$("#acc-room7-chd").val()=="0"&&$("#acc-room8-chd").val()=="0"&&$("#acc-room9-chd").val()=="0"){$(".div-acc-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-acc-chd-room7").hide();}else{$(".div-acc-chd-rooms").show();$("#div-acc-chd-room7").show();for(var i=1;i<=5;i++){var s="#div-acc-chd"+i+"-room7";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#acc-room8-chd").bind("change",function(){if($("#acc-room1-chd").val()=="0"&&$("#acc-room2-chd").val()=="0"&&$("#acc-room3-chd").val()=="0"&&$("#acc-room4-chd").val()=="0"&&$("#acc-room5-chd").val()=="0"&&$("#acc-room6-chd").val()=="0"&&$("#acc-room7-chd").val()=="0"&&$("#acc-room8-chd").val()=="0"&&$("#acc-room9-chd").val()=="0"){$(".div-acc-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-acc-chd-room8").hide();}else{$(".div-acc-chd-rooms").show();$("#div-acc-chd-room8").show();for(var i=1;i<=5;i++){var s="#div-acc-chd"+i+"-room8";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#acc-room9-chd").bind("change",function(){if($("#acc-room1-chd").val()=="0"&&$("#acc-room2-chd").val()=="0"&&$("#acc-room3-chd").val()=="0"&&$("#acc-room4-chd").val()=="0"&&$("#acc-room5-chd").val()=="0"&&$("#acc-room6-chd").val()=="0"&&$("#acc-room7-chd").val()=="0"&&$("#acc-room8-chd").val()=="0"&&$("#acc-room9-chd").val()=="0"){$(".div-acc-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-acc-chd-room9").hide();}else{$(".div-acc-chd-rooms").show();$("#div-acc-chd-room9").show();for(var i=1;i<=5;i++){var s="#div-acc-chd"+i+"-room9";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#acc-more").bind("change",function(){$("#div-acc-more").toggle($("#acc-more").is(":checked"));});}
$("#acc-datein").datepicker($.extend({},dateOptions2,{onSelect:function(dateText,inst){$("#acc-dateout").datepicker('option','minDate',$(this).datepicker('getDate').addDays(vhms));RemoveAddErrorClass($(this));if(vitality){if(isLessThanMinDate('21',$(this).datepicker('getDate'))){$("#vit-Min-Date").show();}else{$("#vit-Min-Date").hide();}}}}));$("#acc-dateout").datepicker(dateOptions3);if(vitality){$("#acc-datein").datepicker('setDate',(accDateIn&&new Date()<new Date(accDateIn)?new Date(accDateIn):'+21d'));$("#acc-dateout").datepicker('setDate',(accDateOut&&new Date()<new Date(accDateOut)?new Date(accDateOut):'+29d'));if($("#acc-datein").length){$("#acc-dateout").datepicker('option','minDate',$("#acc-datein").datepicker('getDate').addDays(vhms));}}
else{$("#acc-datein").datepicker('setDate','+1d');$("#acc-dateout").datepicker('setDate','+8d');}
var totalRooms;if(vitality){totalRooms=9;}
else{totalRooms=3;}
for(var r=1;r<=totalRooms;r++){$("#acc-rooms").append($(r==1?'<option selected="selected"></option>':'<option></option>').val(r).html(r));var adt="#acc-room"+r+"-adt";for(var a=1;a<=9;a++){$(adt).append($(r==1&&a==2?'<option selected="selected"></option>':'<option></option>').val(a).html(a));}
var chd="#acc-room"+r+"-chd";for(var c=0;c<=5;c++){$(chd).append($(c==0?'<option selected="selected"></option>':'<option></option>').val(c).html(c));}}
for(var c=1;c<=5;c++){for(var r=1;r<=totalRooms;r++){var n="#acc-chd"+c+"-room"+r;for(var a=-1;a<=17;a++){$(n).append($(a==-1?'<option selected="selected"></option>':'<option></option>').val(a).html((a==-1?"--":(a==0?"<1":a))));}}}
if(roomOccupancy&&roomOccupancy.length>0){$("#acc-rooms").val(roomOccupancy.length);for(var r=0;r<roomOccupancy.length;r++){var roomNo=r+1;var adt="#acc-room"+roomNo+"-adt";$(adt).val(roomOccupancy[r].Adults);var chd="#acc-room"+roomNo+"-chd";$(chd).val(roomOccupancy[r].Children);if(roomOccupancy[r].ChildrenAges){for(var ca=0;ca<roomOccupancy[r].ChildrenAges.length;ca++){var childAgeNo=ca+1;var chdAge="#acc-chd"+childAgeNo+"-room"+roomNo;$(chdAge).val(roomOccupancy[r].ChildrenAges[ca]);}}}}
$.each(propertytypes,function(i){$("#acc-type").append($(i==0?'<option selected="selected"></option>':'<option></option>').val(propertytypes[i][0]).html(propertytypes[i][1]));});$.each(locationtypes,function(i){$("#acc-location").append($(i==0?'<option selected="selected"></option>':'<option></option>').val(locationtypes[i][0]).html(locationtypes[i][1]));});$.each(hotelchains,function(i){$("#acc-chain").append($(i==0?'<option selected="selected"></option>':'<option></option>').val(hotelchains[i][0]).html(hotelchains[i][1]));});if(vitality){setVitalityPassengerRooms();}}
if(esel&&eshw){$("#event-pnr").bind("change",function(){changePNR('event-pnr');});$("#event-dest").autocomplete({minLength:3,source:function(request,response){$.ajax({cache:false,url:"/selectordestinations",dataType:"json",data:{type:4,filter:request.term},success:function(data){response($.map(data,function(item){return{label:item.Text,value:item.Id}}));}});},focus:function(event,ui){$("#event-dest").val(ui.item.label);return false;},select:function(event,ui){$("#event-dest").val(ui.item.label);$("#event-dest-code").val(ui.item.value);return false;}});$("#event-date-depart").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){$("#event-date-return").datepicker('option','minDate',dateText);}}));$("#event-date-depart").datepicker('setDate','+7d');$("#event-date-return").datepicker(dateOptions);$("#event-date-return").datepicker('setDate','+14d');$.each(eventcategories,function(i){$("#event-category").append($(i==0?'<option selected="selected"></option>':'<option></option>').val(eventcategories[i][0]).html(eventcategories[i][1]));});$("#event-chd").bind("change",function(){if($(this).val()=="0"){$("#div-event-chd").hide();}else{$("#div-event-chd").show();for(var i=1;i<=5;i++){var s="#div-event-chd"+i;if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});for(var a=1;a<=9;a++){$("#event-adt").append($(a==1?'<option selected="selected"></option>':'<option></option>').val(a).html(a));}
for(var c=0;c<=5;c++){$("#event-chd").append($(c==0?'<option selected="selected"></option>':'<option></option>').val(c).html(c));}
for(var c=1;c<=5;c++){var n="#event-chd"+c;for(var a=-1;a<=11;a++){$(n).append($(a==-1?'<option selected="selected"></option>':'<option></option>').val(a).html((a==-1?"--":(a==0?"<1":a))));}}}
if(fasel&&fashw){$("#flight-acc-dest").change(function(){if($.trim($("#flight-acc-dest").val())=="")
$("#flight-acc-dest-code").val("");});var ajaxUrl="/selectordestinationsheirarchy";if(window.location.protocol=="https:"||document.location.protocol=="https:")
{ajaxUrl="/selectordestinationsheirarchyssl";}
$("#flight-acc-dest").hierarchy({delay:0,minLength:3,source:function(request,response){$.ajax({cache:false,url:ajaxUrl,dataType:"json",data:{type:4,filter:request.term},success:function(data){response($.map(data,function(item){return{value:item.Label,dest:item.OJLocationCode,hotel:item.OJHotelCode}}));}})},focus:function(event,ui){$("#flight-acc-dest").val(ui.item.label);return false;},select:function(event,ui){$("#flight-acc-dest").val(ui.item.value);$("#flight-acc-dest").removeClass("form-error")
$("#flight-acc-dest-code").val(ui.item.dest);$("#flight-acc-hotel-code").val(ui.item.hotel);return false;},close:function(event,ui){if($("input[name='journey-type']:checked").attr("id")=="rad-acc"){var hiddenFields=[]
hiddenFields.push({elementId:"flight-acc-dest-code",value:"",highlightElementId:"flight-acc-dest"})
if(!validateHiddenFormFields(hiddenFields)){val=$("#flight-acc-dest").val();$("#flight-acc-dest").hierarchy("search",val);$("#flight-acc-dest").focus();return false;}}}});$("#flight-acc-from-date").datepicker($.extend({},dateOptions2,{onSelect:function(dateText,inst){$("#flight-acc-to-date").datepicker('option','minDate',dateText);RemoveAddErrorClass($(this));}}));$("#flight-acc-from-date").datepicker('setDate','+1d');$("#flight-acc-to-date").datepicker(dateOptions2);$("#flight-acc-to-date").datepicker('setDate','+8d');$.each(countries,function(i){$("#flight-acc-cor").append($(countries[i][0]=="ZA"?'<option selected="selected"></option>':'<option></option>').val(countries[i][0]).html(countries[i][1]));});$("#flight-acc-rooms").bind("change",function(){switch($(this).val()){case'2':$("#div-flight-acc-room2").show();$("#div-flight-acc-room3").hide();$("#flight-acc-room3-chd").val("0");$("#div-flight-acc-chd-room3").hide();break;case'3':$("#div-flight-acc-room2").show();$("#div-flight-acc-room3").show();break;default:$("#div-flight-acc-room2").hide();$("#flight-acc-room2-chd").val("0");$("#div-flight-acc-chd-room2").hide();$("#div-flight-acc-room3").hide();$("#flight-acc-room3-chd").val("0");$("#div-flight-acc-chd-room3").hide();break;}});$("#flight-acc-room1-chd").bind("change",function(){if($("#flight-acc-room1-chd").val()=="0"&&$("#flight-acc-room2-chd").val()=="0"&&$("#flight-acc-room3-chd").val()=="0"){$("#div-flight-acc-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-flight-acc-chd-room1").hide();}else{$("#div-flight-acc-chd-rooms").show();$("#div-flight-acc-chd-room1").show();for(var i=1;i<=5;i++){var s="#div-flight-acc-chd"+i+"-room1";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#flight-acc-room2-chd").bind("change",function(){if($("#flight-acc-room1-chd").val()=="0"&&$("#flight-acc-room2-chd").val()=="0"&&$("#flight-acc-room3-chd").val()=="0"){$("#div-flight-acc-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-flight-acc-chd-room2").hide();}else{$("#div-flight-acc-chd-rooms").show();$("#div-flight-acc-chd-room2").show();for(var i=1;i<=5;i++){var s="#div-flight-acc-chd"+i+"-room2";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#flight-acc-room3-chd").bind("change",function(){if($("#flight-acc-room1-chd").val()=="0"&&$("#flight-acc-room2-chd").val()=="0"&&$("#flight-acc-room3-chd").val()=="0"){$("#div-flight-acc-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-flight-acc-chd-room3").hide();}else{$("#div-flight-acc-chd-rooms").show();$("#div-flight-acc-chd-room3").show();for(var i=1;i<=5;i++){var s="#div-flight-acc-chd"+i+"-room3";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#flight-acc-more").bind("change",function(){$("#div-flight-acc-more").toggle($("#flight-acc-more").is(":checked"));});for(var r=1;r<=3;r++){$("#flight-acc-rooms").append($(r==1?'<option selected="selected"></option>':'<option></option>').val(r).html(r));var adt="#flight-acc-room"+r+"-adt";for(var a=1;a<=9;a++){$(adt).append($(r==1&&a==2?'<option selected="selected"></option>':'<option></option>').val(a).html(a));}
var chd="#flight-acc-room"+r+"-chd";for(var c=0;c<=5;c++){$(chd).append($(c==0?'<option selected="selected"></option>':'<option></option>').val(c).html(c));}}
for(var c=1;c<=5;c++){for(var r=1;r<=3;r++){var n="#flight-acc-chd"+c+"-room"+r;for(var a=-1;a<=11;a++){$(n).append($(a==-1?'<option selected="selected"></option>':'<option></option>').val(a).html((a==-1?"--":(a==0?"<1":a))));}}}
$.each(propertytypes,function(i){$("#flight-acc-type").append($(i==0?'<option selected="selected"></option>':'<option></option>').val(propertytypes[i][0]).html(propertytypes[i][1]));});$.each(locationtypes,function(i){$("#flight-acc-location").append($(i==0?'<option selected="selected"></option>':'<option></option>').val(locationtypes[i][0]).html(locationtypes[i][1]));});$.each(hotelchains,function(i){$("#flight-acc-chain").append($(i==0?'<option selected="selected"></option>':'<option></option>').val(hotelchains[i][0]).html(hotelchains[i][1]));});}
if(fcsel&&fcshw){$("#flight-car-from-date").datepicker($.extend({},dateOptions,{onSelect:function(dateText,inst){$("#flight-car-to-date").datepicker('option','minDate',dateText);RemoveAddErrorClass($(this));}}));$("#flight-car-from-date").datepicker('setDate','+1d');$("#flight-car-to-date").datepicker(dateOptions);$("#flight-car-to-date").datepicker('setDate','+8d');}
if(facsel&&facshw){$("#flight-acc-car-dest").change(function(){if($.trim($("#flight-acc-car-dest").val())==""){$("#flight-acc-car-dest-code").val("");}});var ajaxUrl="/selectordestinationsheirarchy";if(window.location.protocol=="https:"||document.location.protocol=="https:")
{ajaxUrl="/selectordestinationsheirarchyssl";}
$("#flight-acc-car-dest").hierarchy({delay:0,minLength:3,source:function(request,response){$.ajax({cache:false,url:ajaxUrl,dataType:"json",data:{type:4,filter:request.term},success:function(data){response($.map(data,function(item){return{value:item.Label,dest:item.OJLocationCode,hotel:item.OJHotelCode}}));}})},focus:function(event,ui){$("#flight-acc-car-dest").val(ui.item.label);return false;},select:function(event,ui){$("#flight-acc-car-dest").val(ui.item.value);$("#flight-acc-car-dest").removeClass("form-error")
$("#flight-acc-car-dest-code").val(ui.item.dest);$("#flight-acc-car-hotel-code").val(ui.item.hotel);return false;},close:function(event,ui){if($("input[name='journey-type']:checked").attr("id")=="rad-acc"){var hiddenFields=[]
hiddenFields.push({elementId:"flight-acc-car-dest-code",value:"",highlightElementId:"flight-acc-car-dest"})
if(!validateHiddenFormFields(hiddenFields)){val=$("#flight-acc-car-dest").val();$("#flight-acc-car-dest").hierarchy("search",val);$("#flight-acc-car-dest").focus();return false;}}}});$("#flight-acc-car-from-date").datepicker($.extend({},dateOptions2,{onSelect:function(dateText,inst){$("#flight-acc-car-to-date").datepicker('option','minDate',dateText);RemoveAddErrorClass($(this));}}));$("#flight-acc-car-from-date").datepicker('setDate','+1d');$("#flight-acc-car-to-date").datepicker(dateOptions2);$("#flight-acc-car-to-date").datepicker('setDate','+8d');$.each(countries,function(i){$("#flight-acc-car-cor").append($(countries[i][0]=="ZA"?'<option selected="selected"></option>':'<option></option>').val(countries[i][0]).html(countries[i][1]));});$("#flight-acc-car-rooms").bind("change",function(){switch($(this).val()){case'2':$("#div-flight-acc-car-room2").show();$("#div-flight-acc-car-room3").hide();$("#flight-acc-car-room3-chd").val("0");$("#div-flight-acc-car-chd-room3").hide();break;case'3':$("#div-flight-acc-car-room2").show();$("#div-flight-acc-car-room3").show();break;default:$("#div-flight-acc-car-room2").hide();$("#flight-acc-car-room2-chd").val("0");$("#div-flight-acc-car-chd-room2").hide();$("#div-flight-acc-car-room3").hide();$("#flight-acc-car-room3-chd").val("0");$("#div-flight-acc-car-chd-room3").hide();break;}});$("#flight-acc-car-room1-chd").bind("change",function(){if($("#flight-acc-car-room1-chd").val()=="0"&&$("#flight-acc-car-room2-chd").val()=="0"&&$("#flight-acc-car-room3-chd").val()=="0"){$(".div-flight-acc-car-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-flight-acc-car-chd-room1").hide();}else{$(".div-flight-acc-car-chd-rooms").show();$("#div-flight-acc-car-chd-room1").show();for(var i=1;i<=5;i++){var s="#div-flight-acc-car-chd"+i+"-room1";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#flight-acc-car-room2-chd").bind("change",function(){if($("#flight-acc-car-room1-chd").val()=="0"&&$("#flight-acc-car-room2-chd").val()=="0"&&$("#flight-acc-car-room3-chd").val()=="0"){$(".div-flight-acc-car-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-flight-acc-car-chd-room2").hide();}else{$(".div-flight-acc-car-chd-rooms").show();$("#div-flight-acc-car-chd-room2").show();for(var i=1;i<=5;i++){var s="#div-flight-acc-car-chd"+i+"-room2";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#flight-acc-car-room3-chd").bind("change",function(){if($("#flight-acc-car-room1-chd").val()=="0"&&$("#flight-acc-car-room2-chd").val()=="0"&&$("#flight-acc-car-room3-chd").val()=="0"){$(".div-flight-acc-car-chd-rooms").hide();}
if($(this).val()=="0"){$("#div-flight-acc-car-chd-room3").hide();}else{$(".div-flight-acc-car-chd-rooms").show();$("#div-flight-acc-car-chd-room3").show();for(var i=1;i<=5;i++){var s="#div-flight-acc-car-chd"+i+"-room3";if(i<=parseInt($(this).val())){$(s).show();}else{$(s).hide();}}}});$("#flight-acc-car-more").bind("change",function(){$("#div-flight-acc-car-more").toggle($("#flight-acc-car-more").is(":checked"));});for(var r=1;r<=3;r++){$("#flight-acc-car-rooms").append($(r==1?'<option selected="selected"></option>':'<option></option>').val(r).html(r));var adt="#flight-acc-car-room"+r+"-adt";for(var a=1;a<=9;a++){$(adt).append($(r==1&&a==2?'<option selected="selected"></option>':'<option></option>').val(a).html(a));}
var chd="#flight-acc-car-room"+r+"-chd";for(var c=0;c<=5;c++){$(chd).append($(c==0?'<option selected="selected"></option>':'<option></option>').val(c).html(c));}}
for(var c=1;c<=5;c++){for(var r=1;r<=3;r++){var n="#flight-acc-car-chd"+c+"-room"+r;for(var a=-1;a<=11;a++){$(n).append($(a==-1?'<option selected="selected"></option>':'<option></option>').val(a).html((a==-1?"--":(a==0?"<1":a))));}}}
$.each(propertytypes,function(i){$("#flight-acc-car-type").append($(i==0?'<option selected="selected"></option>':'<option></option>').val(propertytypes[i][0]).html(propertytypes[i][1]));});$.each(locationtypes,function(i){$("#flight-acc-car-location").append($(i==0?'<option selected="selected"></option>':'<option></option>').val(locationtypes[i][0]).html(locationtypes[i][1]));});$.each(hotelchains,function(i){$("#flight-acc-car-chain").append($(i==0?'<option selected="selected"></option>':'<option></option>').val(hotelchains[i][0]).html(hotelchains[i][1]));});}
if(fsel&&fshw){$("#window").dialog("open");var type=1;if(document.location.href.toLowerCase().indexOf('window')>0){type=2;}
setTimeout(function(){var ajaxUrl="/getflightrequest";if(window.location.protocol=="https:"||document.location.protocol=="https:")
{ajaxUrl="/getflightrequestSSL";}
$.ajax({cache:false,url:ajaxUrl,data:{type:type}}).done(function(searchcriteria){if(searchcriteria=="")
{return;}
if(searchcriteria.Adults>0){$('#ddlAdults').val(searchcriteria.Adults);}
if(searchcriteria.Children>0){$("#ddlChildren").val(searchcriteria.Children);}
if(searchcriteria.Infants>0){$("#ddlInfants").val(searchcriteria.Infants);}
if(searchcriteria.SelectedMembers!=null&&vitality){$.each(searchcriteria.SelectedMembers,function(){var memberId=this.EntityNumber;$("#discovery_"+memberId).click();var selectedDiscounts=this.DiscountTypes.split(',');$.each(selectedDiscounts,function(){$("input[name$=_"+memberId+"][value="+this+"]").click();});});}
var segmentCount=1;$.each(searchcriteria.SegmentDates,function(segmentDate,segment){switch(searchcriteria.SearchType){case 2:{$('input:radio[value="RT"]').click();switch(segmentCount){case 1:{$('#ddlDepartureAirport').val(segment.DepartureAirportCode);$('#ddlDepartureAirport').change();$('#fromDate').val(segment.DepartureDateString);break;}
case 2:{$('#toDate').val(segment.DepartureDateString);break;}}
break;}
case 3:{$('input:radio[value="MC"]').click();$("#flight-multi-from"+segmentCount).val(segment.DepartureAirportCode);$("#flight-multi-from"+segmentCount).change();$("#flight-multi-date"+segmentCount).val(segment.DepartureDateString);if(segmentCount>3)
{$('#div-multi-from'+segmentCount).show();$('#div-multi-to'+segmentCount).show();$('#div-multi-date'+segmentCount).show();if(segmentCount>4){$("#flight-multi-add").hide();}}
break;}
case 1:default:{$('input:radio[value="OW"]').click();$('#ddlDepartureAirport').val(segment.DepartureAirportCode);$('#ddlDepartureAirport').change();$('#fromDate').val(segment.DepartureDateString);$('#toDate').val(segment.DepartureDateString);break;}}
segmentCount++;});setTimeout(function(){segmentCount=1;$.each(searchcriteria.SegmentDates,function(segmentDate,segment){switch(searchcriteria.SearchType){case 3:{$("#flight-multi-to"+segmentCount).val(segment.ArrivalAirportCode);break;}
case 1:case 2:default:{if(segmentCount==1){$("#ddlArrivalAirport").val(segment.ArrivalAirportCode);}
break;}}
segmentCount++;});},1500);if(searchcriteria.TravelClassId!=null){$("#ddlServiceClass").val(searchcriteria.TravelClassId);}});},500);}
var currentPage=window.location.pathname;if($(window).width()>600){var urlTab=getUrlVars()["vs"];if(!urlTab){switch(currentPage){case"/hotels":$("#rad-acc").trigger("click");break;case"/cars":$("#rad-car").trigger("click");break;default:setVisibleSelector();if(!$("[name*=VisibleSelector]").val()){$("#rad-flight").trigger("click");}
break;}}}
var urlJourneyType=getUrlVars()["book"];if(urlJourneyType){$("#"+urlJourneyType).trigger("click");}
$("#combo-type li").click(function(){$("[type='combo-select']").removeClass("displaydiv");$("#combo-type").children().each(function(){$(this).attr('class','');$('input:radio[name=combo-type]').prop('checked',false);});$(this).addClass('selected');comboDiv="#"+this.id.replace("li","div");$(comboDiv).addClass('displaydiv');comboRad=comboDiv.replace("#div","rad");$('input:radio[name=combo-type][id='+comboRad+']').prop('checked',true);});var infantChildMessage="<div class=\"childInfantMessage\" style=\"display:none;\"><fieldset><p>Infants and children under the age of 12&nbsp;years must be accompanied by an adult aged 16&nbsp;years or older.<br />&raquo; <a href=\"/flights/infants\" onclick=\"_gaq.push(['_trackEvent', 'selector', 'children selected', 'flying with infants and children']);\">flying with infants and children</a></p></fieldset></div>";$("#ddlChildren, #ddlInfants, #flight-car-chd, #flight-car-inf").change(function(){if($(this).val()>0){if($(this).parents(".passengers").children(".childInfantMessage").length==0){$(this).parents(".passengers").append(infantChildMessage).children(".childInfantMessage").fadeIn();}else{$(this).parents(".passengers").children(".childInfantMessage").fadeIn();}}else{if($(this).parents(".passengers").find("select:eq(1)").val()==0&&$(this).parents(".passengers").find("select:eq(2)").val()==0){$(this).parents(".passengers").children(".childInfantMessage").fadeOut();}}});if($("#window")){$("#window").dialog("close");}});function removeFlightTypeClass(){$("#flight-type").children().each(function(){$(this).removeClass("selected");});}
function removeBargainClass(){$("#BargainBrowza").children().each(function(){$(this).removeClass("selected");});}
function CheckOptions(){ignore=false;if(options){if($("#ddl-option").length==0&&$("input[name='selector-options']:checked").val()!=null){return true;}
if($("#ddl-option").length>0&&$("#ddl-option").val()!=""){return true;}
if($("#ddl-option").length==0){$("#selector-option-error").attr("style","display:block;");$(".question").attr("style","border:1px solid #9E0000;");$('html, body').animate({scrollTop:$('#SelQuestion').offset().top},'slow');}
$("#window").dialog("close");ignore=true
return false;}
return true;}
function CheckEntities(entities){ignore=false;if(entities.length==0){$("#window").dialog("close");showError('Please select at least one Discovery traveller.',500,500,"e");ignore=true;return false;}
return true;}
function loadFlight(data){_travellers=myData.Travellers;if(_travellers==null){$("#travellerholder").hide();}
else{$("#travellerholder").show();}}
function DataLoadAjax(){if((fsel&&fshw)||(fcsel&&fcshw)){buildExtras();}
if(fsel&&fshw){$("#ddlDepartureAirport").bind("change",departAirportChanged);$("#ddlArrivalAirport").bind("change",arrivalAirportChanged);$("#flight-return-from").bind("change",returnFromAirportChanged);$("#flight-depart-from2").bind("change",returnFromDetailAirportChanged);$("#flight-return-to").bind("change",returnToAirportChanged);$("#flight-arrive-to2").bind("change",returnToDetailAirportChanged);if(frdt!=6){$("#promotions").hide();}
if(ftcl){$("#fareoptionsholder .selector-airline").hide();$("#FrequentFlyer").show();}
if(!fmul){$("#flight-multi-from1").bind("change",function(){multiCityDepartureAirportChangedAjax($(this))});$("#flight-multi-from2").bind("change",function(){multiCityDepartureAirportChangedAjax($(this))});$("#flight-multi-from3").bind("change",function(){multiCityDepartureAirportChangedAjax($(this))});$("#flight-multi-from4").bind("change",function(){multiCityDepartureAirportChangedAjax($(this))});$("#flight-multi-from5").bind("change",function(){multiCityDepartureAirportChangedAjax($(this));});}}
if(fcsel&&fcshw){$("#flight-car-from").bind("change",departFlightCarAirportChanged);}}
function buildExtras(){if(fsel&&fshw){$("#ddlAdults").children().remove().end();$("#ddlChildren").children().remove().end();$("#ddlInfants").children().remove().end();}
if(fcsel&&fcshw){$("#flight-car-adt").children().remove().end();$("#flight-car-chd").children().remove().end();$("#flight-car-inf").children().remove().end();}
for(var i=0;i<=9;i++){if(fsel&&fshw){if(i>0){$("#ddlAdults").append($('<option></option>').val(i).html(i));}
if(i<=8){$("#ddlChildren").append($('<option></option>').val(i).html(i));}
if(i<=3){$("#ddlInfants").append($('<option></option>').val(i).html(i));}}
if(fcsel&&fcshw){if(i>0){$("#flight-car-adt").append($('<option></option>').val(i).html(i));}
if(i<=5){$("#flight-car-chd").append($('<option></option>').val(i).html(i));}
if(i<=5){$("#flight-car-inf").append($('<option></option>').val(i).html(i));}}}}
function setVitalityPassengerRooms(){$('select[id^="ddlVitality_"]').each(function(){var selected=$(this).val();$(this).children().remove();$(this).append($('<option></option>').val("0").html("select"));for(var i=1;i<=$("#acc-rooms").val();i++){$(this).append($('<option></option>').val(i).html("room "+i.toString()));}
var exists=false;$(this).children().each(function(){if(this.value==selected){exists=true;return false;}});if(exists){$(this).val(selected);}});}
function segmentTypeChanged(e){var segmentTypeId=$("input:radio[id='zone']:checked").val();getSelectorSegments();}
function getSelectorSegments(){var ajaxUrl="/selectorsegments";if(window.location.protocol=="https:"||document.location.protocol=="https:")
{ajaxUrl="/selectorsegmentsSSL";}
$.ajax({cache:false,url:ajaxUrl+"?userTypeId="+_userTypeId+"&segmentTypeId="+_segmentTypeId+"&hostId="+frdt,success:function(result){_selectorSegments=result;buildDepartureAirports();$("#window").dialog("close");}});}
function isLessThanMinDate(minDays,selectedDate){var minDate=new Date();minDate.setDate(minDate.getDate()+parseInt(minDays));minDate.setHours(0,0,0,0);return(selectedDate<minDate);}
function getSegments(){var list=[];$.each(_segments,function(s){var found=findSegment(this.Id);if(found){list.push(this);}});list.sort(function SortByDisplayOrder(a,b){return a.DepartureAirport.DisplayOrder-b.DepartureAirport.DisplayOrder});return list;}
function findSegment(segmentId){for(var i=0,len=_selectorSegments.length;i<len;i++){if(_selectorSegments[i].UserTypeId===_userTypeId&&_selectorSegments[i].SegmentId===segmentId&&((vitality&&fint)?_selectorSegments[i].HostId==frdt:true))
return true;}
return false;}
function getSelectedSegment(){return getSegment($("#ddlDepartureAirport").val(),$("#ddlArrivalAirport").val());}
function getSegment(fromAirportCode,toAirportCode){return $.grep(getSegments(),function(a){return a.DepartureAirport.IATA_Code==fromAirportCode&&a.ArrivalAirport.IATA_Code==toAirportCode})[0];}
function segmentAirport(IATACode,airportName){this.IATACode=IATACode;this.airportName=airportName;}
$.extend($.expr[":"],{containsExact:$.expr.createPseudo?$.expr.createPseudo(function(text){return function(elem){return $.trim(elem.innerHTML.toLowerCase())===text.toLowerCase();};}):function(elem,i,match){return $.trim(elem.innerHTML.toLowerCase())===match[3].toLowerCase();},containsExactCase:$.expr.createPseudo?$.expr.createPseudo(function(text){return function(elem){return $.trim(elem.innerHTML)===text;};}):function(elem,i,match){return $.trim(elem.innerHTML)===match[3];}});function containsObjectById(arr,obj){for(var i=0,len=arr.length;i<len;i++){if(arr[i].Id==obj.Id){return true;}}
return false;}
function getUniqueContinentsAjax(departureAirportCode,hostId,callFrom){var params={DepartureAirportCode:departureAirportCode,UserTypeId:_userTypeId,SegmentTypeId:_segmentTypeId,HostId:hostId,TripType:$("input[name=flight-type]:checked").attr("segments")};$.ajax({cache:false,data:params,url:"/selectorArrivalContinents",success:function(result){if(callFrom=='flight')
setArrivalContinents(result);$("#window").dialog("close");}});}
function getUniqueDeparturesAjax(arrivalAirportCode,hostId,callFrom,originAirportCode){var isHub=(callFrom=='international')?true:false;var params={ArrivalAirportCode:arrivalAirportCode,UserTypeId:_userTypeId,SegmentTypeId:_segmentTypeId,HostId:hostId,TripType:$("input[name=flight-type]:checked").attr("segments"),IsHub:isHub};var ajaxUrl="/selectorDepartureAirports";if(window.location.protocol=="https:"||document.location.protocol=="https:")
{ajaxUrl="/selectorDepartureAirportsSSL";}
$.ajax({cache:false,data:params,url:ajaxUrl,success:function(result){if(callFrom=='flight')
setFlightDepartureAirports(result);else if(callFrom=='combination')
setCombinationDepartureAirports(result);else if(callFrom=='international')
setStopOverAirports(result,arrivalAirportCode);else if(callFrom=='stopover')
setStopOverDepartureAirports(result,originAirportCode);$("#window").dialog("close");}});}
function getUniqueArrivalsAjax(departureAirportCode,hostId,callFrom,toList,countryId,defaultArrivalAirportCode){var ajaxUrl;var params={DepartureAirportCode:departureAirportCode,UserTypeId:_userTypeId,SegmentTypeId:_segmentTypeId,HostId:hostId,TripType:$("input[name=flight-type]:checked").attr("segments")};if(fcas){params["CountryId"]=countryId;ajaxUrl="/selectorArrivalAirportsCascading";}
else{ajaxUrl="/selectorArrivalAirports";if(window.location.protocol=="https:"||document.location.protocol=="https:")
{ajaxUrl="/selectorArrivalAirportsSSL";}}
$.ajax({cache:false,data:params,url:ajaxUrl,success:function(result){if(callFrom=='flight')
setFlightArrivalAirports(result,defaultArrivalAirportCode);else if(callFrom=='multicity')
setMultiCityArrivalAirports(result,toList,defaultArrivalAirportCode);else if(callFrom=='flightcar')
setFlightCarArrivalAirports(result);$("#window").dialog("close");}});}
function setArrivalContinents(continents){if(fsel&&fshw){$("#ddlArrivalContinent").children().remove().end();$("#ddlArrivalContinent").append($('<option></option>').val("").html("Select region"));$.each(continents,function(){if(fsel&&fshw&&fcas){if($("#ddlArrivalContinent:containsExact('"+this.Name+"')").text()==''){$("#ddlArrivalContinent").append($('<option></option>').val(this.Id).html(this.Name));}}});$("#ddlArrivalContinent").unbind("change");$("#ddlArrivalContinent").bind("change",function(){arrivalContinentChangedAjax()});arrivalContinentChangedAjax()}}
function arrivalContinentChangedAjax(){$("#window").dialog("open");if(fsel&&fshw){$("#ddlArrivalCountry").children().remove().end();$("#ddlArrivalCountry").append($('<option></option>').val("").html("Select country"));getUniqueCountriesAjax($("#ddlArrivalContinent").val(),$("#ddlDepartureAirport").val(),frdt,'flight');}}
function getUniqueCountriesAjax(continentId,departureAirport,hostId,callFrom,toList){var params={ContinentId:continentId,DepartureAirportCode:departureAirport,UserTypeId:_userTypeId,SegmentTypeId:_segmentTypeId,HostId:hostId,TripType:$("input[name=flight-type]:checked").attr("segments")};$.ajax({cache:false,data:params,url:"/selectorArrivalCountries",success:function(result){if(callFrom=='flight')
setArrivalCountries(result);$("#window").dialog("close");}});}
function setArrivalCountries(countries){_countryIds=[];if(fsel&&fshw&&fcas){$.each(countries,function(){if(fsel&&fshw&&fcas){if($("#ddlArrivalCountry:containsExact('"+this.Name+"')").text()==''&&this.Id!=206){$("#ddlArrivalCountry").append($('<option></option>').val(this.Id).html(this.Name));}}
_countryIds.push(this.Id);});$("#ddlArrivalCountry").unbind("change").bind("change",function(){arrivalCountryChangedAjax()});}}
function arrivalCountryChangedAjax(){$("#window").dialog("open");$("#ddlArrivalAirport").children().remove().end();$("#ddlArrivalAirport").append($('<option></option>').val("").html("Select city"));getUniqueArrivalsAjax($("#ddlDepartureAirport").val(),frdt,'flight',null,$("#ddlArrivalCountry").val());}
function setFlightDepartureAirports(airports){if(fsel&&fshw){$("#ddlDepartureAirport").children().remove().end();$("#ddlArrivalAirport").children().remove().end();if(!fmul){$("#flight-multi-from1").children().remove().end();$("#flight-multi-from2").children().remove().end();$("#flight-multi-from3").children().remove().end();$("#flight-multi-from4").children().remove().end();$("#flight-multi-from5").children().remove().end();}}
$.each(airports,function(){if(fsel&&fshw){if((fint||vitality)&&this.CountryId!=206){return;}
if($("#ddlDepartureAirport:containsExact('"+this.Name+"')").text()==''){$("#ddlDepartureAirport").append($('<option></option>').val(this.IATA_Code).html(this.Name));}
if(!fmul){if($("#flight-multi-from1:containsExact('"+this.Name+"')").text()==''){$("#flight-multi-from1").append($('<option></option>').val(this.IATA_Code).html(this.Name));}
if($("#flight-multi-from2:containsExact('"+this.Name+"')").text()==''){$("#flight-multi-from2").append($('<option></option>').val(this.IATA_Code).html(this.Name));}
if($("#flight-multi-from3:containsExact('"+this.Name+"')").text()==''){$("#flight-multi-from3").append($('<option></option>').val(this.IATA_Code).html(this.Name));}
if($("#flight-multi-from4:containsExact('"+this.Name+"')").text()==''){$("#flight-multi-from4").append($('<option></option>').val(this.IATA_Code).html(this.Name));}
if($("#flight-multi-from5:containsExact('"+this.Name+"')").text()==''){$("#flight-multi-from5").append($('<option></option>').val(this.IATA_Code).html(this.Name));}}}});if(fsel&&fshw&&!fmul){$("#flight-multi-from1").bind("change",function(){multiCityDepartureAirportChangedAjax($(this))});$("#flight-multi-from2").bind("change",function(){multiCityDepartureAirportChangedAjax($(this))});$("#flight-multi-from3").bind("change",function(){multiCityDepartureAirportChangedAjax($(this))});$("#flight-multi-from4").bind("change",function(){multiCityDepartureAirportChangedAjax($(this))});$("#flight-multi-from5").bind("change",function(){multiCityDepartureAirportChangedAjax($(this));});$("#flight-multi-from1").change();$("#flight-multi-from2").change();$("#flight-multi-from3").change();$("#flight-multi-from4").change();$("#flight-multi-from5").change();}
departAirportChanged();}
function setCombinationDepartureAirports(airports){if(fasel&&fashw){$("#flight-acc-from").children().remove().end();}
if(fcsel&&fcshw){$("#flight-car-from").children().remove().end();$("#flight-car-to").children().remove().end();}
if(facsel&&facshw){$("#flight-acc-car-from").children().remove().end();}
$.each(airports,function(){if(fasel&&fashw){if($("#flight-acc-from:containsExact('"+this.Name+"')").text()==''){$("#flight-acc-from").append($('<option></option>').val(this.IATA_Code).html(this.Name));}}
if(fcsel&&fcshw){if($("#flight-car-from:containsExact('"+this.Name+"')").text()==''){$("#flight-car-from").append($('<option></option>').val(this.IATA_Code).html(this.Name));}}
if(facsel&&facshw){if($("#flight-acc-car-from:containsExact('"+this.Name+"')").text()==''){$("#flight-acc-car-from").append($('<option></option>').val(this.IATA_Code).html(this.Name));}}});departFlightCarAirportChanged();}
function setStopOverDepartureAirports(airports,arrivalAirportCode){$("#flight-return-from").children().remove().end();$("#flight-depart-from2").children().remove().end();$.each(airports,function(){if(_countryIds.indexOf(this.CountryId)>-1){if($("#flight-return-from:containsExact('"+this.Name+"')").text()==''){$("#flight-return-from").append($('<option></option>').val(this.IATA_Code).html(this.Name));}
if($("#flight-depart-from2:containsExact('"+this.Name+"')").text()==''){$("#flight-depart-from2").append($('<option></option>').val(this.IATA_Code).html(this.Name));}}});$("#flight-return-from").val(arrivalAirportCode);$("#flight-depart-from2").val(arrivalAirportCode);}
function setStopOverAirports(airports,arrivalAirportCode){var displayLink=false;$("#flight-depart-to1").children().remove().end();$("#flight-arrive-from1").children().remove().end();$("#flight-depart-to2").children().remove().end();$("#flight-arrive-from2").children().remove().end();var internationalAirports=airports.filter(function(x){return x.CountryId!="206";});if(internationalAirports.length){$.each(internationalAirports,function(){if($("#flight-depart-to1:containsExact('"+this.Name+"')").text()==''){$("#flight-depart-to1").append($('<option></option>').val(this.IATA_Code).html(this.Name));getUniqueDeparturesAjax($("#flight-depart-to1").val(),4,"stopover",arrivalAirportCode);}
if($("#flight-arrive-from1:containsExact('"+this.Name+"')").text()==''){$("#flight-arrive-from1").append($('<option></option>').val(this.IATA_Code).html(this.Name));}
if($("#flight-depart-to2:containsExact('"+this.Name+"')").text()==''){$("#flight-depart-to2").append($('<option></option>').val(this.IATA_Code).html(this.Name));}
if($("#flight-arrive-from2:containsExact('"+this.Name+"')").text()==''){$("#flight-arrive-from2").append($('<option></option>').val(this.IATA_Code).html(this.Name));}
var segments=$("input[name=flight-type]:checked").attr("segments");if(segments==3){displayLink=true;}});}
else{hideDepartStopOver();hideReturnStopOver();$("#btn-display-return-detail").hide();$("#btn-display-depart-detail").hide();}
if(displayLink){displayStopOvers();}}
function multiCityDepartureAirportChangedAjax(fromList){$("#window").dialog("open");var toList=fromList.attr("id").replace('from','to');$("#"+toList).children().remove().end();getUniqueArrivalsAjax(fromList.val(),frdt,'multicity',toList);}
function doesAirlineFlySegment(segmentId,airlineId){var count=$.grep(_selectorSegments,function(a){return a.UserTypeId==_userTypeId&&a.SegmentId==segmentId&&a.AirlineId==airlineId}).length;return(count>0);}
function doesAirlineFlyFromAirport(airportId,airlineId){var segments=$.grep(getSegments(),function(a){return a.DepartureAirport.Id==airportId});for(var i=0,len=segments.length;i<len;i++){if(doesAirlineFlySegment(segments[i].Id,airlineId))
return true;}
return false;}
function departAirportChanged(){$("#window").dialog("open");if(fsel&&fshw){$("#ddlArrivalAirport").children().remove().end();$("#ddlArrivalAirport").append($('<option></option>').val("").html("Select airport"));if(fcas){getUniqueContinentsAjax($("#ddlDepartureAirport").val(),frdt,'flight');updateStopOverDeparture();}
else{getUniqueArrivalsAjax($("#ddlDepartureAirport").val(),frdt,'flight');}}}
function departFlightCarAirportChanged(){$("#window").dialog("open");getUniqueArrivalsAjax($("#flight-car-from").val(),fcrdt,'flightcar');}
function setFlightCarArrivalAirports(airports){$("#flight-car-to").children().remove().end();$.each(airports,function(){if($("#flight-car-to:contains('"+this.Name+"')").text()==''){$("#flight-car-to").append($('<option></option>').val(this.IATA_Code).html(this.Name));}});}
function setFlightArrivalAirports(airports,defaultArrivalAirportCode){$.each(airports,function(){if($("#ddlArrivalAirport:containsExact('"+this.Name+"')").text()==''){$("#ddlArrivalAirport").append($('<option></option>').val(this.IATA_Code).html(this.Name));}});if(defaultArrivalAirportCode!=null)
{$("#ddlArrivalAirport").val(defaultArrivalAirportCode);}
arrivalAirportChanged();}
function setMultiCityArrivalAirports(airports,toList,defaultArrivalAirportCode){$.each(airports,function(){if($("#"+toList+":containsExact('"+this.Name+"')").text()==''){$("#"+toList).append($('<option></option>').val(this.IATA_Code).html(this.Name));}});if(defaultArrivalAirportCode!=null)
{$("#"+toList).val(defaultArrivalAirportCode);}
$("#"+toList).change();if(_travelclasses==undefined){getTravelClassesAjax();}}
function arrivalAirportChanged(){$("#window").dialog("open");try{getTravelClassesAjax();if(fcas){var segments=$("input[name=flight-type]:checked").attr("segments");var arrivalAirport=$("#ddlArrivalAirport").val();if(segments==3){displayStopOvers();}
else{hideStopOvers();}}}
catch(e){$("#window").dialog("close");}}
function returnToAirportChanged(){$("#flight-arrive-to2").val($("#flight-return-to").val());}
function returnFromAirportChanged(){$("#flight-depart-from2").val($("#flight-return-from").val());}
function returnToDetailAirportChanged(){$("#flight-return-to").val($("#flight-arrive-to2").val());}
function returnFromDetailAirportChanged(){$("#flight-return-from").val($("#flight-depart-from2").val());}
function setTravelClasses(travelClasses){var originalServiceClass=$("#ddlServiceClass").val();$("#ddlServiceClass").children().remove().end();_travelclasses=travelClasses;$.each(travelClasses,function(){$("#ddlServiceClass").append($('<option></option>').val(this.Id).html(this.Description));if(this.Id==originalServiceClass)
$("#ddlServiceClass").val(this.Id);});$("#ddlServiceClass").change();$("#window").dialog("close");}
function getAirlines(){if($("#rad-multi").is(":checked")){return getAirlinesMultiCity();}
var list=[];if(getSelectedSegment()){var segmentId=getSelectedSegment().Id;var travelClassId=$("#ddlServiceClass").val();$.each(_airlines,function(s){var found=findAirlines(segmentId,this.Id,travelClassId);if(found){list.push(this);}});}else{var travelClassId=$("#ddlServiceClass").val();$.each(_airlines,function(s){var airline=this;$.each(_selectorSegments,function(){var found=findAirlines(this.SegmentId,airline.Id,travelClassId);if(found){list.push(airline);return false;}});});}
return list;}
function getAirlinesMultiCity(){var list=[];var travelClassId=$("#ddlServiceClass").val();for(var i=1;i<=5;i++){var from=$("#flight-multi-from"+i);var to=$("#flight-multi-to"+i);if(from.is(":visible")){var segment=getSegment(from.val(),to.val());$.each(_airlines,function(s){var found=findAirlines(segment.Id,this.Id,travelClassId);if(found){if($.inArray(this,list)<0){list.push(this);}}});}}
return list;}
function getAirlineIataCode(airlineId){if(airlineId)
return $.grep(_airlines,function(a){return a.Id==airlineId})[0].IATA_Code;else
return'';}
function getTravelClassCode(travelClassId){if(travelClassId){if(_travelclasses==undefined){return getTravelClassAjax(travelClassId);}
else{return $.grep(_travelclasses,function(a){return a.Id==travelClassId})[0].Code;}}
else
return'Y';}
function findAirlines(segmentId,airlineId,travelClassId){for(var i=0,len=_selectorSegments.length;i<len;i++){if(_selectorSegments[i].UserTypeId===_userTypeId&&_selectorSegments[i].SegmentId===segmentId&&_selectorSegments[i].TravelClassId===travelClassId)
return true;}
return false;}
function airlineChanged(e){manageDatePickers();manageAllocations();}
function getTravelClassesAjax(){$("#window").dialog("open");var params={departureAirportCode:$("#ddlDepartureAirport").val(),arrivalAirportCode:$("#ddlArrivalAirport").val(),segmentTypeId:_segmentTypeId,userTypeId:_userTypeId,hostId:frdt};var ajaxUrl="/selectorTravelClasses";if(window.location.protocol=="https:"||document.location.protocol=="https:")
{ajaxUrl="/selectorTravelClassesSSL";}
$.ajax({cache:false,data:params,url:ajaxUrl,success:function(result){setTravelClasses(result);$("#window").dialog("close");}});}
function getTravelClassAjax(travelClassId){$("#window").dialog("open");var params={departureAirportCode:$("#ddlDepartureAirport").val(),arrivalAirportCode:$("#ddlArrivalAirport").val(),segmentTypeId:_segmentTypeId,userTypeId:_userTypeId,hostId:frdt};var ajaxUrl="/selectorTravelClasses";if(window.location.protocol=="https:"||document.location.protocol=="https:")
{ajaxUrl="/selectorTravelClassesSSL";}
$.ajax({cache:false,data:params,url:ajaxUrl,success:function(result){return $.grep(result,function(a){return a.Id==travelClassId})[0].Code;}});}
function findTravelClass(segmentId,travelClassId){for(var i=0,len=_selectorSegments.length;i<len;i++){if(_selectorSegments[i].SegmentId===segmentId&&_selectorSegments[i].TravelClassId===travelClassId)
return true;}
return false;}
function getTravelClassSabreName(travelClassId){var matches=$.grep(_travelclasses,function(t){return t.Id==travelClassId});if(matches.length>0){return matches[0].SabreDescription;}else{return"ECONOMY";}}
function getTravelClassOpenJawName(travelClassId){var matches=$.grep(_travelclasses,function(t){return t.Id==travelClassId});if(matches.length>0){return matches[0].OpenJawDescription;}else{return"ECONOMY";}}
function manageDatePickers(){if(getSelectedSegment()){$("#toDate").datepicker('option',{minDate:getDatePickerStartDate(),maxDate:getDatePickerEndDate()});$("#fromDate").datepicker('option',{minDate:getDatePickerStartDate(),maxDate:getDatePickerEndDate()});}}
function getDatePickerStartDate(){var airlineId=$("#ddlFlightAirline").val();var segmentId=getSelectedSegment().Id;var travelClassId=$("#ddlServiceClass").val();var days=$.grep(_selectorSegments,function(a){return a.SegmentId==segmentId&&a.AirlineId==airlineId&&a.TravelClassId==travelClassId})[0].SearchMinDays;var start=new Date();start.setDate(start.getDate()+days);return start;}
function getDatePickerEndDate(){var airlineId=$("#ddlFlightAirline").val();var segmentId=getSelectedSegment().Id;var travelClassId=$("#ddlServiceClass").val();var days=$.grep(_selectorSegments,function(a){return a.SegmentId==segmentId&&a.AirlineId==airlineId&&a.TravelClassId==travelClassId})[0].SearchMaxDays;var end=new Date();end.setDate(end.getDate()+days);return end;}
function manageExtras(){if($("input:checkbox[id='chktraveller']:checked").length>0){$("#extras select").removeAttr('disabled');}
else{$("#extras select").attr('disabled',true);buildExtras();}}
function manageAllocations(){var allocationId=$("input:radio[id='zone']:checked").val()+"/"+$("#ddlFlightAirline").val();$("div[id='alloc']").hide();$("div[alloc*='"+allocationId+"']").show();}
function setVisibleSelector(){var sel=$('input[name=journey-type]:checked').val();var vs="";switch(sel){case"fsel":vs="1";break;case"csel":vs="2";break;case"asel":vs="3";break;case"facsel":vs="4";break;case"esel":vs="5";break;default:vs="1";break;};$("[name*=VisibleSelector]").val(vs);}
function toggleDisplay(r){$("#selector-option-error").hide();$(".question").attr("style","");if(jtyp&&r!='all-off'){$('[type="selector-tab"]').attr('style','');$("#journey-type").children().each(function(){var c="#"+this.id.replace("li","rad");var d=c.replace("rad","div");var m=c.replace("#rad",".journey-type-mobi");if(c==r){$(d).show();$(m).addClass("selected");moveLogin(d);}else{$(d).hide();$(m).removeClass("selected");}});}
else{$('[type="selector"]').each(function(){$(this).hide();});$('[type="selector-tab"]').each(function(){$(this).hide();});moveLogin('#LoginDetail');}}
function validateMembers(){var count=0;$("input[type='hidden'][id^='maxTravelClass']").each(function(){var elementId=$(this).attr('id');var id=elementId.split('_');if($(this).val()<$("#ddlServiceClass").val()){$("#discovery_"+id[1]).prop('disabled',true);$("#discovery_"+id[1]).prop('checked',false);$("#member_benefits_"+id[1]).removeClass('active');$("#member_benefits_"+id[1]).find('label').addClass('disabled');count++;}
else
{$("#discovery_"+id[1]).prop('disabled',false);$("#member_benefits_"+id[1]).find('label').removeClass('disabled');if($("#ddlServiceClass").val()==3){$("#purpleDiscount_"+id[1]).click();}}});if(count>0){$("#TravelClassError").show();}
else{$("#TravelClassError").hide();}}
function removeQuestion(){$("#li-option-vitality").removeClass("selected");$("#div-vitality").hide();$("#li-option-vitality-login").removeClass("selected");$("#div-vitality-login").hide();$("#li-option-ebucks").removeClass("selected");$("#div-ebucks").hide();$("#li-option-ebucks-login").removeClass("selected");$("#div-ebucks-login").hide();$("#li-option-no").removeClass("selected");$("input[name='selector-options']").each(function(){$(this).prop("checked",false);});}
function toggleOptions(d){if(d=='on'){if($("input[id='rad-option-vitality']:checked").val()=='on'||$("#ddl-option").val()=="vitality"){removeQuestion();$("#li-option-vitality").addClass("selected");$("#rad-option-vitality").prop("checked",true);$("#div-vitality").show();}
if($("input[id='rad-option-vitality-login']:checked").val()=='on'||$("#ddl-option").val()=="vitality-login"){removeQuestion();$("#li-option-vitality-login").addClass("selected");$("#rad-option-vitality-login").prop("checked",true);$("#div-vitality-login").show();}
if($("input[id='rad-option-ebucks']:checked").val()=='on'||$("#ddl-option").val()=="ebucks"){removeQuestion();$("#li-option-ebucks").addClass("selected");$("#rad--option-ebucks").prop("checked",true);$("#div-ebucks").show();}
if($("input[id='rad-option-ebucks-login']:checked").val()=='on'||$("#ddl-option").val()=="ebucks-login"){removeQuestion();$("#li-option-ebucks-login").addClass("selected");$("#rad-option-ebucks-login").prop("checked",true);$("#div-ebucks-login").show();}
$(".action").hide();$(".btn-expand").hide();$('[type="selector-tab"]').each(function(){$(this).hide();});toggleDisplay("all-off");}
else{if(d=="none"){removeQuestion();}else{if($("input[id='rad-option-no']:checked").val()=='on'||$("#ddl-option").val()=="no"){removeQuestion();if(jtyp){var r="#"+$("input[name='journey-type']:checked").attr('id');var l=r.replace("rad","li");toggleDisplay(r);}
else{$('[type="selector"]').each(function(){$(this).show();});$('[type="selector-tab"]').attr('style','');}
$("#li-option-no").addClass("selected");$("#rad-option-no").prop("checked",true);$(".action").attr('style','');$(".btn-expand").attr('style','');}}}}
function setPNR(pnr){try{$('#car-pnr').val(pnr);}catch(e){}
try{$('#acc-pnr').val(pnr);}catch(e){}
try{$('#event-pnr').val(pnr);}catch(e){}}
function changePNR(ctl){switch(ctl){case'car-pnr':try{$('#acc-pnr').val($('#car-pnr').val());}catch(e){}
try{$('#event-pnr').val($('#car-pnr').val());}catch(e){}
break;case'acc-pnr':try{$('#car-pnr').val($('#acc-pnr').val());}catch(e){}
try{$('#event-pnr').val($('#acc-pnr').val());}catch(e){}
break;case'event-pnr':try{$('#car-pnr').val($('#event-pnr').val());}catch(e){}
try{$('#acc-pnr').val($('#event-pnr').val());}catch(e){}
break;}}
function getSelectedVitalityMembers(){if(!f){var f=$("#form-flight");}
var checkedMembers=$("#vitality-travellers-table").find("input[id^='discovery_']:checked");var entities=[];$.each(checkedMembers,function(){var entityNo=this.id.split("_")[1];entities.push(entityNo);});if(!CheckEntities(entities)){return false;}
return entities;}
function getSelectedDiscoveryMembers(){if(!f){var f=$("#form-flight");}
var checkedMembers=$("#vitality-travellers-table").find("input[id^='discovery_']:checked");var members=[];$.each(checkedMembers,function(){var entityNo=this.id.split("_")[1];var checkedDiscounts=$("input[name$='Discount_"+entityNo+"']:checked");var discountTypes=[];$.each(checkedDiscounts,function(){if($(this).is(':disabled')==false){discountTypes.push($(this).val());}});var member={EntityNumber:entityNo,DiscountTypes:discountTypes.join(",")}
members.push(member);});if(!CheckEntities(members)){return false;}
return members;}
function searchFlight(){var fields=[];if($("#ddl-option").length>0){fields.push({elementId:"ddl-option",value:""})}
fields.push({elementId:"ddlArrivalAirport",value:""})
fields.push({elementId:"fromDate",value:""})
fields.push({elementId:"toDate",value:""})
var redirectToUrl=true;for(var i=1;i<6;i++){var date="flight-multi-date"+i;fields.push({elementId:date,value:""})}
if(!validateFormFields(fields)){return false;}
activeButton=$("#btn-flight");if(!CheckOptions()){return false;}
var url=furl;var dd=$.datepicker.formatDate('yy-mm-dd',$('#fromDate').datepicker('getDate'));var rd=$.datepicker.formatDate('yy-mm-dd',$('#toDate').datepicker('getDate'));switch(frdt){case 1:var f=$("#form-flight");if(document.location.href.toLowerCase().indexOf('window')>0){f.attr("target","_parent");}
f.find("[id='SearchType']").remove();f.find("[id='AirlineCode']").remove();f.find("[id='TravelClass']").remove();f.find("[id='Adults']").remove();f.find("[id='Children']").remove();f.find("[id='Infants']").remove();f.append("<input id='SearchType' name='SearchType' type='hidden' value='"+$("input[name='flight-type']:checked").val()+"'/>");f.append("<input id='AirlineCode' name='AirlineCode' type='hidden' value='"+getAirlineIataCode($("#ddlFlightAirline").val())+"'/>");f.append("<input id='TravelClass' name='TravelClass' type='hidden' value='"+getTravelClassCode($("#ddlServiceClass").val())+"'/>");f.append("<input id='TravelClassId' name='TravelClassId' type='hidden' value='"+$("#ddlServiceClass").val()+"'/>");if(vitality){f.append("<input id='Adults' name='Adults' type='hidden' value='0'/>");f.append("<input id='Children' name='Children' type='hidden' value='0'/>");f.append("<input id='Infants' name='Infants' type='hidden' value='0'/>");}else{f.append("<input id='Adults' name='Adults' type='hidden' value='"+$("#ddlAdults").val()+"'/>");f.append("<input id='Children' name='Children' type='hidden' value='"+$("#ddlChildren").val()+"'/>");f.append("<input id='Infants' name='Infants' type='hidden' value='"+$("#ddlInfants").val()+"'/>");}
f.find("[id='PromotionCode']").remove();f.append("<input id='PromotionCode' name='PromotionCode' type='hidden' value='"+$("#promoCode").val()+"'/>");var segments=[];f.find("[id^='SegmentDates_']").remove();switch($("input[name='flight-type']:checked").val()){case"OW":f.append("<input id='SegmentDates_0__DepartureAirportCode' name='SegmentDates[0].DepartureAirportCode' type='hidden' value=''/>");f.append("<input id='SegmentDates_0__ArrivalAirportCode' name='SegmentDates[0].ArrivalAirportCode' type='hidden' value=''/>");f.append("<input id='SegmentDates_0__DepartureDate' name='SegmentDates[0].DepartureDate' type='hidden' value=''/>");$("#SegmentDates_0__DepartureAirportCode").val($("#ddlDepartureAirport").val());$("#SegmentDates_0__ArrivalAirportCode").val($("#ddlArrivalAirport").val());$("#SegmentDates_0__DepartureDate").val($("#fromDate").val());var s={DepartureAirportCode:$("#ddlDepartureAirport").val(),ArrivalAirportCode:$("#ddlArrivalAirport").val(),DepartureDate:$("#fromDate").val()};segments.push(s);break;case"RT":f.append("<input id='SegmentDates_0__DepartureAirportCode' name='SegmentDates[0].DepartureAirportCode' type='hidden' value=''/>");f.append("<input id='SegmentDates_0__ArrivalAirportCode' name='SegmentDates[0].ArrivalAirportCode' type='hidden' value=''/>");f.append("<input id='SegmentDates_0__DepartureDate' name='SegmentDates[0].DepartureDate' type='hidden' value=''/>");f.append("<input id='SegmentDates_1__DepartureAirportCode' name='SegmentDates[1].DepartureAirportCode' type='hidden' value=''/>");f.append("<input id='SegmentDates_1__ArrivalAirportCode' name='SegmentDates[1].ArrivalAirportCode' type='hidden' value=''/>");f.append("<input id='SegmentDates_1__DepartureDate' name='SegmentDates[1].DepartureDate' type='hidden' value=''/>");$("#SegmentDates_0__DepartureAirportCode").val($("#ddlDepartureAirport").val());$("#SegmentDates_0__ArrivalAirportCode").val($("#ddlArrivalAirport").val());$("#SegmentDates_0__DepartureDate").val($("#fromDate").val());$("#SegmentDates_1__DepartureAirportCode").val($("#ddlArrivalAirport").val());$("#SegmentDates_1__ArrivalAirportCode").val($("#ddlDepartureAirport").val());$("#SegmentDates_1__DepartureDate").val($("#toDate").val());var s1={DepartureAirportCode:$("#SegmentDates_0__DepartureAirportCode").val(),ArrivalAirportCode:$("#SegmentDates_0__ArrivalAirportCode").val(),DepartureDate:$("#SegmentDates_0__DepartureDate").val()};segments.push(s1);var s2={DepartureAirportCode:$("#SegmentDates_1__DepartureAirportCode").val(),ArrivalAirportCode:$("#SegmentDates_1__ArrivalAirportCode").val(),DepartureDate:$("#SegmentDates_1__DepartureDate").val()};segments.push(s2);break;case"MC":var c=2;if($("#div-multi-from3").is(":visible")){c=3;}
if($("#div-multi-from4").is(":visible")){c=4;}
if($("#div-multi-from5").is(":visible")){c=5;}
for(var i=0;i<c;i++){f.append("<input id='SegmentDates_"+i+"__DepartureAirportCode' name='SegmentDates["+i+"].DepartureAirportCode' type='hidden' value=''/>");f.append("<input id='SegmentDates_"+i+"__ArrivalAirportCode' name='SegmentDates["+i+"].ArrivalAirportCode' type='hidden' value=''/>");f.append("<input id='SegmentDates_"+i+"__DepartureDate' name='SegmentDates["+i+"].DepartureDate' type='hidden' value=''/>");var s="#SegmentDates_"+i+"__DepartureAirportCode";var s1="#flight-multi-from"+(i+1);$(s).val($(s1).val());s="#SegmentDates_"+i+"__ArrivalAirportCode";s1="#flight-multi-to"+(i+1);$(s).val($(s1).val());s="#SegmentDates_"+i+"__DepartureDate"
s1="#flight-multi-date"+(i+1);$(s).val($(s1).val());var segment={DepartureAirportCode:$("#SegmentDates_"+i+"__DepartureAirportCode").val(),ArrivalAirportCode:$("#SegmentDates_"+i+"__ArrivalAirportCode").val(),DepartureDate:$("#SegmentDates_"+i+"__DepartureDate").val()};segments.push(segment);}
break;}
if(vitality){var checkedMembers=$("#vitality-travellers-table").find("input[id^='discovery_']:checked");var entities=[];var members=[];var memberCount=0;f.find("[id^='SelectedMembers_']").remove();$.each(checkedMembers,function(){var entityNo=this.id.split("_")[1];entities.push(entityNo);var checkedDiscounts=$("input[name$='Discount_"+entityNo+"']:checked");var discountTypes=[];if(checkedDiscounts.length==0){var msg="Please select discounts for each selected member.";$("#window").dialog("close");showError(msg,500,500,"e");return false;}
$.each(checkedDiscounts,function(){if($(this).is(':disabled')==false){discountTypes.push($(this).val());}});var member={EntityNumber:entityNo,DiscountTypes:discountTypes.join(",")}
members.push(member);f.append("<input id='SelectedMembers_"+memberCount+"__EntityNumber' name='SelectedMembers["+memberCount+"].EntityNumber' type='hidden' value='"+entityNo+"'/>");f.append("<input id='SelectedMembers_"+memberCount+"__DiscountTypes' name='SelectedMembers["+memberCount+"].DiscountTypes' type='hidden' value='"+discountTypes.join(",")+"'/>");memberCount++;});if(!CheckEntities(entities)||!CheckEntities(members)){return false;}
f.find("[id='SelectedEntities']").remove();f.append("<input id='SelectedEntities' name='SelectedEntities' type='hidden' value='"+entities.join(',')+"'/>");var searchCriteria={SelectedEntities:entities.join(","),SelectedMembers:members,SegmentDates:segments,Adults:0,Children:0,Infants:0,TravelClassId:$('#ddlServiceClass').val(),SegmentTypeId:_segmentTypeId,HostId:frdt};var postData={json:JSON.stringify(searchCriteria)};document.getElementsByTagName('form')[0].target="_parent";var ajaxUrl="/discovery/validateselector";if(window.location.protocol=="https:"||document.location.protocol=="https:")
{ajaxUrl="/discovery/validateselectorSSL";}
$.ajax({cache:false,type:"GET",traditional:true,dataType:"json",data:postData,url:ajaxUrl,error:function(){var msg="An unexpected error occurred while processing your selection. Please refresh the page or restart the booking process.";$("#window").dialog("close");showError(msg,500,500,"e");},success:function(data){if(data.Successful){if(window.location.protocol=="https:"||document.location.protocol=="https:"){f.attr('action',"/flightssl")}
f.submit();}else{$("#window").dialog("close");showError(data.Message,500,500,"e");}}});}else{f.submit();}
return;break;case 2:break;case 3:$.ajax({cache:false,url:"/updateredirectcounter?itemId="+widid});if($("#rad-lowestFare").is(":checked")){url+="?searchType=CALENDAR";}
else{url+="?searchType=NORMAL";}
url+="&alternativeLandingPage=true";url+="&journeySpan="+$("input[name='flight-type']:checked").val();switch($("input[name='flight-type']:checked").val()){case"OW":url+="&origin="+$('#ddlDepartureAirport').val();url+="&destination="+$('#ddlArrivalAirport').val();url+="&departureDate="+dd;break;case"RT":url+="&origin="+$('#ddlDepartureAirport').val();url+="&destination="+$('#ddlArrivalAirport').val();url+="&departureDate="+dd;url+="&returnDate="+rd;break;case"MC":url+="&origin="+$('#flight-multi-from1').val();url+="&destination="+$('#flight-multi-to1').val();url+="&departureDate="+$.datepicker.formatDate('yy-mm-dd',$('#flight-multi-date1').datepicker('getDate'));url+="&origin2="+$('#flight-multi-from2').val();url+="&destination2="+$('#flight-multi-to2').val();url+="&departureDate2="+$.datepicker.formatDate('yy-mm-dd',$('#flight-multi-date2').datepicker('getDate'));if($('#div-multi-from3').is(':visible')){url+="&origin3="+$('#flight-multi-from3').val();url+="&destination3="+$('#flight-multi-to3').val();url+="&departureDate3="+$.datepicker.formatDate('yy-mm-dd',$('#flight-multi-date3').datepicker('getDate'));}
if($('#div-multi-from4').is(':visible')){url+="&origin4="+$('#flight-multi-from4').val();url+="&destination4="+$('#flight-multi-to4').val();url+="&departureDate4="+$.datepicker.formatDate('yy-mm-dd',$('#flight-multi-date4').datepicker('getDate'));}
if($('#div-multi-from5').is(':visible')){url+="&origin5="+$('#flight-multi-from5').val();url+="&destination5="+$('#flight-multi-to5').val();url+="&departureDate5="+$.datepicker.formatDate('yy-mm-dd',$('#flight-multi-date5').datepicker('getDate'));}
break;}
url+="&numAdults="+$('#ddlAdults').val();url+="&numChildren="+$('#ddlChildren').val();url+="&numInfants="+$('#ddlInfants').val();url+="&cabin="+getTravelClassSabreName($('#ddlServiceClass').val());if($('#promoCode').val()!=null&&$('#promoCode').val()!=''){url+="&promoCode="+$('#promoCode').val();}
break;case 4:redirectToUrl=false;var segments=[];url+='&LAN=EN&PT=F';url+='&ORILT=IATA';url+='&DESLT=IATA';switch($("input[name='flight-type']:checked").val()){case"OW":url+='&DD1='+dd;url+='&FLC=1';url+='&ORI='+$('#ddlDepartureAirport').val();url+='&DES='+$('#ddlArrivalAirport').val();var s1={DepartureAirportCode:$('#ddlDepartureAirport').val(),ArrivalAirportCode:$('#ddlArrivalAirport').val(),DepartureDate:dd};segments.push(s1);break;case"RT":url+='&DD1='+dd;url+='&DD2='+rd;url+='&FLC=2';url+='&ORI='+$('#ddlDepartureAirport').val();url+='&DES='+$('#ddlArrivalAirport').val();var s1={DepartureAirportCode:$('#ddlDepartureAirport').val(),ArrivalAirportCode:$('#ddlArrivalAirport').val(),DepartureDate:dd};segments.push(s1);var s2={DepartureAirportCode:$('#ddlArrivalAirport').val(),ArrivalAirportCode:$('#ddlDepartureAirport').val(),DepartureDate:rd};segments.push(s2);break;case"MC":if($("#div-stop-overs").is(":visible")){var segmentCount=0;if($("#div-flight-depart-detail").is(":visible")){var dd1=$.datepicker.formatDate('yy-mm-dd',$('#flight-depart-date1').datepicker('getDate'));var dd2=$.datepicker.formatDate('yy-mm-dd',$('#flight-arrive-date1').datepicker('getDate'));var df1=$('#flight-depart-from1').val();var dt1=$('#flight-depart-to1').val();var df2=$('#flight-arrive-from1').val();var dt2=$('#flight-arrive-to1').val();url+='&DD1='+dd1;url+='&ORI1='+df1;url+='&DES1='+dt1;url+='&DD2='+dd2;url+='&ORI2='+df2;url+='&DES2='+dt2;var s1={DepartureAirportCode:df1,ArrivalAirportCode:dt1,DepartureDate:dd1};var s2={DepartureAirportCode:df2,ArrivalAirportCode:dt2,DepartureDate:dd2};segments.push(s1);segments.push(s2);if($("#div-flight-return-detail").is(":visible")){var dd3=$.datepicker.formatDate('yy-mm-dd',$('#flight-depart-date2').datepicker('getDate'));var dd4=$.datepicker.formatDate('yy-mm-dd',$('#flight-arrive-date2').datepicker('getDate'));var df3=$('#flight-depart-from2').val();var dt3=$('#flight-depart-to2').val();var df4=$('#flight-arrive-from2').val();var dt4=$('#flight-arrive-to2').val();url+='&DD3='+dd3;url+='&ORI3='+df3;url+='&DES3='+dt3;url+='&DD4='+dd4;url+='&ORI4='+df4;url+='&DES4='+dt4;var s3={DepartureAirportCode:df3,ArrivalAirportCode:dt3,DepartureDate:dd3};var s4={DepartureAirportCode:df4,ArrivalAirportCode:dt4,DepartureDate:dd4};segments.push(s3);segments.push(s4);segmentCount=4;}
else{var df3=$('#flight-return-from').val();var dt3=$('#flight-return-to').val();var dd3=$.datepicker.formatDate('yy-mm-dd',$('#flight-return-date').datepicker('getDate'));url+='&DD3='+dd3;url+='&ORI3='+df3;url+='&DES3='+dt3;var s3={DepartureAirportCode:df3,ArrivalAirportCode:dt3,DepartureDate:dd3};segments.push(s3);segmentCount=3;}}
else{var dd1=$.datepicker.formatDate('yy-mm-dd',$('#flight-depart-date').datepicker('getDate'));url+='&DD1='+dd1;url+='&ORI1='+$('#ddlDepartureAirport').val();url+='&DES1='+$('#ddlArrivalAirport').val();var s1={DepartureAirportCode:$('#ddlDepartureAirport').val(),ArrivalAirportCode:$('#ddlArrivalAirport').val(),DepartureDate:dd1};segments.push(s1);if($("#div-flight-return-detail").is(":visible")){var dd2=$.datepicker.formatDate('yy-mm-dd',$('#flight-depart-date2').datepicker('getDate'));var dd3=$.datepicker.formatDate('yy-mm-dd',$('#flight-arrive-date2').datepicker('getDate'));var df2=$('#flight-depart-from2').val();var dt2=$('#flight-depart-to2').val();var df3=$('#flight-arrive-from2').val();var dt3=$('#flight-arrive-to2').val();url+='&DD2='+dd2;url+='&ORI2='+df2;url+='&DES2='+dt2;url+='&DD3='+dd3;url+='&ORI3='+df3;url+='&DES3='+dt3;var s2={DepartureAirportCode:df2,ArrivalAirportCode:dt2,DepartureDate:dd2};var s3={DepartureAirportCode:df3,ArrivalAirportCode:dt3,DepartureDate:dd3};segments.push(s2);segments.push(s3);segmentCount=3;}
else{var df2=$('#flight-return-from').val();var dt2=$('#flight-return-to').val();var dd2=$.datepicker.formatDate('yy-mm-dd',$('#flight-return-date').datepicker('getDate'));url+='&DD2='+dd2;url+='&ORI2='+df2;url+='&DES2='+dt2;var s2={DepartureAirportCode:df2,ArrivalAirportCode:dt2,DepartureDate:dd2};segments.push(s2);segmentCount=2;}}
url+='&FLC='+segmentCount;}
else{url+='&DD1='+dd;url+='&DD2='+rd;url+='&FLC=2';url+='&ORI='+$('#ddlDepartureAirport').val();url+='&DES='+$('#ddlArrivalAirport').val();var s1={DepartureAirportCode:$('#ddlDepartureAirport').val(),ArrivalAirportCode:$('#ddlArrivalAirport').val(),DepartureDate:dd};segments.push(s1);var s2={DepartureAirportCode:$('#ddlArrivalAirport').val(),ArrivalAirportCode:$('#ddlDepartureAirport').val(),DepartureDate:rd};segments.push(s2);}
break;}
var aCnt=$('#ddlAdults').val();var cCnt=$('#ddlChildren').val();var iCnt=$('#ddlInfants').val();url+='&MO=T';url+='&CN='+getTravelClassOpenJawName($('#ddlServiceClass').val());if(vitality){var entities=getSelectedVitalityMembers();var members=getSelectedDiscoveryMembers();var checkedMembers=$("#vitality-travellers-table").find("input[id^='discovery_']:checked");var members=[];$.each(checkedMembers,function(){var entityNo=this.id.split("_")[1];entities.push(entityNo);var checkedDiscounts=$("input[name$='Discount_"+entityNo+"']:checked");var discountTypes=[];$.each(checkedDiscounts,function(){if($(this).is(':disabled')==false){discountTypes.push($(this).val());}});var member={EntityNumber:entityNo,DiscountTypes:discountTypes.join(",")}
members.push(member);});if(!CheckEntities(members)){return false;}
var searchCriteria={SelectedEntities:entities.toString(),SelectedMembers:members,SegmentDates:segments,Adults:0,Children:0,Infants:0,TravelClassId:$('#ddlServiceClass').val(),SegmentTypeId:_segmentTypeId,HostId:frdt,};var isHub=false;var postData={json:JSON.stringify(searchCriteria)};var arrivalAirportCode=$('#ddlArrivalAirport').val();if($("#div-flight-depart-detail").is(":visible")){arrivalAirportCode=$('#flight-depart-to1').val();isHub=true;}
var selectedSegment={HostId:frdt,UserTypeId:_userTypeId,ItineraryStart:dd,DepartureCode:$('#ddlDepartureAirport').val(),ArrivalCode:arrivalAirportCode,TravelClassId:$('#ddlServiceClass').val(),IsHub:isHub};var ajaxUrl="/discovery/validateselector";if(window.location.protocol=="https:"||document.location.protocol=="https:")
{ajaxUrl="/discovery/validateselectorSSL";}
$.ajax({cache:false,type:"GET",traditional:true,dataType:"json",data:postData,url:ajaxUrl,error:function(){var msg="An unexpected error occurred while processing your selection. Please refresh the page or restart the booking process.";$("#window").dialog("close");showError(msg,500,500,"e");},success:function(data){if(data.Successful){url='/selectorflightredirect?segmentTypeId='+_segmentTypeId+'&url='+url.replace('?','%3F').replace(/&/g,'%26')+'&SelectedEntities='+entities+'&SelectedMembers='+JSON.stringify(members)+'&Segment='+JSON.stringify(selectedSegment);window.location.href=url;}else{$("#window").dialog("close");showError(data.Message,500,500,"e");}}});}
break;case 6:if($("#lowestFare").is(":checked")){url+="date-selection";}
else{url+="flight-selection";}
url+="?locale=en-GB&currency=ZAR";switch($("input[name='flight-type']:checked").val()){case"OW":url+="&journeyType=one-way";url+="&origin="+$('#ddlDepartureAirport').val();url+="&destination="+$('#ddlArrivalAirport').val();if($("#lowestFare").is(":checked")){url+="&activeMonth="+$.datepicker.formatDate('mm-dd-yy',$('#fromDate').datepicker('getDate'));}
else{url+="&date="+$.datepicker.formatDate('mm-dd-yy',$('#fromDate').datepicker('getDate'));}
break;case"RT":url+="&journeyType=round-trip";url+="&origin="+$('#ddlDepartureAirport').val();url+="&destination="+$('#ddlArrivalAirport').val();url+="&origin1="+$('#ddlArrivalAirport').val();url+="&destination1="+$('#ddlDepartureAirport').val();if($("#lowestFare").is(":checked")){url+="&activeMonth="+$.datepicker.formatDate('mm-dd-yy',$('#fromDate').datepicker('getDate'));}
else{url+="&date="+$.datepicker.formatDate('mm-dd-yy',$('#fromDate').datepicker('getDate'));url+="&date1="+$.datepicker.formatDate('mm-dd-yy',$('#toDate').datepicker('getDate'));}
break;case"MC":url+="&journeyType=multi-city";url+="&origin="+$('#flight-multi-from1').val();url+="&destination="+$('#flight-multi-to1').val();url+="&origin1="+$('#flight-multi-from2').val();url+="&destination1="+$('#flight-multi-to2').val();if($("#lowestFare").is(":checked")){url+="&activeMonth="+$.datepicker.formatDate('mm-dd-yy',$('#flight-multi-date1').datepicker('getDate'));}
else{url+="&date="+$.datepicker.formatDate('mm-dd-yy',$('#flight-multi-date1').datepicker('getDate'));url+="&date1="+$.datepicker.formatDate('mm-dd-yy',$('#flight-multi-date2').datepicker('getDate'));}
if($('#div-multi-from3').is(':visible')){url+="&origin2="+$('#flight-multi-from3').val();url+="&destination2="+$('#flight-multi-to3').val();if(!$("#lowestFare").is(":checked")){url+="&date2="+$.datepicker.formatDate('mm-dd-yy',$('#flight-multi-date3').datepicker('getDate'));}}
if($('#div-multi-from4').is(':visible')){url+="&origin3="+$('#flight-multi-from4').val();url+="&destination3="+$('#flight-multi-to4').val();if(!$("#lowestFare").is(":checked")){url+="&date3="+$.datepicker.formatDate('mm-dd-yy',$('#flight-multi-date4').datepicker('getDate'));}}
if($('#div-multi-from5').is(':visible')){url+="&origin4="+$('#flight-multi-from5').val();url+="&destination4="+$('#flight-multi-to5').val();if(!$("#lowestFare").is(":checked")){url+="&date4="+$.datepicker.formatDate('mm-dd-yy',$('#flight-multi-date5').datepicker('getDate'));}}
break;}
url+="&ADT="+$('#ddlAdults').val();url+="&CHD="+$('#ddlChildren').val();url+="&INF="+$('#ddlInfants').val();url+="&class="+$('#ddlServiceClass option:selected').text();if($('#promoCode').val()!=null&&$('#promoCode').val()!=''){url+="&promoCode="+$('#promoCode').val();}
var updateUrl='/sabreredirect?userIP='+_userIP+'&url='+encodeURIComponent(url);url=updateUrl;if(useAlt){$.ajax({cache:false,url:"/updateredirectdetails?itemId="+widid,});if(document.getElementById("window")!=null){$("#window").dialog("close");ignore=true;}
redirectToUrl=false;showError("Nice! You will be one of the first to go through our new flight shopping experience.<br/><br/>Hope you enjoy.<br/>The kulula team",500,500,'e',url);}
break;}
if(redirectToUrl){this.location.href=url;}}
function searchCar(){var fields=[];if($("#ddl-option").length>0){fields.push({elementId:"ddl-option",value:""})}
fields.push({elementId:"car-pick-up",value:""})
fields.push({elementId:"car-drop-off",value:""})
fields.push({elementId:"car-pick-up-date",value:""})
fields.push({elementId:"car-drop-off-date",value:""})
if(!validateFormFields(fields)){return false;}
var driver=$("input[name='driver']:checked").val();if(vitality&&!driver){$("#window").dialog("close");showError('Please select a Discovery driver.',500,500,"e");ignore=true;return false;}
if($("#car-pick-up").val()=="00"||$("#car-pick-up").val()=="01"||$("#car-pick-up").val()=="02"){ignore=true;$("#car-pick-up").addClass("form-error");return false;}
if($("#car-drop-off").val()=="00"||$("#car-drop-off").val()=="01"||$("#car-drop-off").val()=="02"){ignore=true;$("#car-drop-off").addClass("form-error");return false;}
activeButton=$("#btn-car");if(!CheckOptions()){return false;}
var url=curl;var dd1=$.datepicker.formatDate('yy-mm-dd',$('#car-pick-up-date').datepicker('getDate'));var dd2=$.datepicker.formatDate('yy-mm-dd',$('#car-drop-off-date').datepicker('getDate'));switch(crdt){case 1:break;case 2:url+='&pu='+$("#car-pick-up").val();url+='&pud='+dd1;url+='&put='+$('#car-pick-up-time').val();url+='&do='+$('#car-drop-off').val();url+='&dod='+dd2;url+='&dot='+$('#car-drop-off-time').val();url+='&del='+($('#car-deliver').attr('checked')?"on":"");url+='&pup='+($('#car-collect').attr('checked')?"on":"");url+='&txtURL='+rl;break;case 3:break
case 4:url+='&LAN=EN&PRE=F&PT=V';if(cuoj){url+='&ORILT=OJ&DESLT=OJ&MO=T';}
else{url+='&ORILT=ECAR&DESLT=ECAR&MO=T';}
url+='&ORI='+$("#car-pick-up").val();url+='&DD1='+dd1;url+='&AT1='+$('#car-pick-up-time').val();url+='&DES='+$('#car-drop-off').val();url+='&DD2='+dd2;url+='&DT2='+$('#car-drop-off-time').val();if(!vitality){url+='&TA=1';}
if($('#car-pnr').val()!=null&&$.trim($('#car-pnr').val())!=''){var pnr=$.trim($('#car-pnr').val())
url+='&PNR='+pnr.toUpperCase();url+='&SUP=1S';}
url+='&RL='+rl+'&HL='+hl;if(vitality){var driver=$("input[name='driver']:checked").val();var additional=$("input[name='add-driver']:checked").val()==undefined?'':$("input[name='add-driver']:checked").val();url='/selectorredirect?type='+crdt+'&url='+url.replace('?','%3F').replace(/&/g,'%26')+'&driver='+driver+'&additional='+additional;}
break;}
if(crdt==4){var postData={pickup:$("#car-pick-up").val(),dropoff:$("#car-drop-off").val(),pickupDateTime:$.datepicker.formatDate('dd M yy',$('#car-pick-up-date').datepicker('getDate'))+' '+$('#car-pick-up-time').val(),dropoffDateTime:$.datepicker.formatDate('dd M yy',$('#car-drop-off-date').datepicker('getDate'))+' '+$('#car-drop-off-time').val(),useOJLocationCode:cuoj};$.ajax({cache:false,type:"GET",traditional:true,dataType:"json",data:postData,url:"/car/validateselector",error:function(){var msg="An unexpected error occurred while processing your selection. Please refresh the page or restart the booking process.";$("#window").dialog("close");showError(msg,500,500,"e");},success:function(data){if(data.Successful){window.location.href=url.replace(/&amp;/g,'&');}else{$("#window").dialog("close");showError(data.Message,500,500,"e");}}});}else{this.location.href=url;}}
function validateHiddenFormFields(fields){var result=true;for(var i=0;i<fields.length;i++){var elementId=fields[i].elementId;var highightFormField=fields[i].highlightElementId;if($("#"+elementId).val()==fields[i].value){$("#"+highightFormField).addClass("form-error");$('html, body').animate({scrollTop:$("#"+highightFormField).offset().top},'slow');if(result){ignore=true;result=false;}}
else{$("#"+highightFormField).removeClass("form-error");}}
return result;}
function validateFormFields(fields){var result=true;var c=-1;for(var i=0;i<fields.length;i++){var elementId=fields[i].elementId;if($("#"+elementId).is(":visible")&&$("#"+elementId).val()==fields[i].value){$("#"+elementId).addClass("form-error");if(result){ignore=true;result=false;}
if(c==-1){$("#"+elementId).focus();c=i;$('html, body').animate({scrollTop:$("#"+elementId).offset().top},'slow');}}
else{$("#"+elementId).removeClass("form-error");}}
return result;}
function getRoomsDetail(){var rooms=[];try{var room1={Adults:$('#acc-room1-adt').val(),Children:$('#acc-room1-chd').val()}
if($('#acc-room1-chd').val()!='0'){var room1Children=[];for(var i=1;i<=parseInt($("#acc-room1-chd").val());i++){if($('#acc-chd'+i+'-room1').val()<0){return null;}
room1Children.push($('#acc-chd'+i+'-room1').val());}
room1['ChildrenAges']=room1Children;}
rooms.push(room1);if($("#acc-rooms").val()>1&&$('#acc-room2-adt').val()!='0'){var room2={Adults:$('#acc-room2-adt').val(),Children:$('#acc-room2-chd').val()}
if($('#acc-room2-chd').val()!='0'){var room2Children=[];for(var i=1;i<=parseInt($("#acc-room2-chd").val());i++){if($('#acc-chd'+i+'-room2').val()<0){return null;}
room2Children.push($('#acc-chd'+i+'-room2').val());}
room2['ChildrenAges']=room2Children;}
rooms.push(room2);}
if($("#acc-rooms").val()>2&&$('#acc-room3-adt').val()!='0'){var room3={Adults:$('#acc-room3-adt').val(),Children:$('#acc-room3-chd').val()}
if($('#acc-room3-chd').val()!='0'){var room3Children=[];for(var i=1;i<=parseInt($("#acc-room3-chd").val());i++){if($('#acc-chd'+i+'-room3').val()<0){return null;}
room3Children.push($('#acc-chd'+i+'-room3').val());}
room3['ChildrenAges']=room3Children;}
rooms.push(room3);}
if($("#acc-rooms").val()>3&&$('#acc-room4-adt').val()!='0'){var room4={Adults:$('#acc-room4-adt').val(),Children:$('#acc-room4-chd').val()}
if($('#acc-room4-chd').val()!='0'){var room4Children=[];for(var i=1;i<=parseInt($("#acc-room4-chd").val());i++){if($('#acc-chd'+i+'-room4').val()<0){return null;}
room4Children.push($('#acc-chd'+i+'-room4').val());}
room4['ChildrenAges']=room4Children;}
rooms.push(room4);}
if($("#acc-rooms").val()>4&&$('#acc-room5-adt').val()!='0'){var room5={Adults:$('#acc-room5-adt').val(),Children:$('#acc-room5-chd').val()}
if($('#acc-room5-chd').val()!='0'){var room5Children=[];for(var i=1;i<=parseInt($("#acc-room5-chd").val());i++){if($('#acc-chd'+i+'-room5').val()<0){return null;}
room5Children.push($('#acc-chd'+i+'-room5').val());}
room5['ChildrenAges']=room5Children;}
rooms.push(room5);}
if($("#acc-rooms").val()>5&&$('#acc-room6-adt').val()!='0'){var room6={Adults:$('#acc-room6-adt').val(),Children:$('#acc-room6-chd').val()}
if($('#acc-room6-chd').val()!='0'){var room6Children=[];for(var i=1;i<=parseInt($("#acc-room6-chd").val());i++){if($('#acc-chd'+i+'-room6').val()<0){return null;}
room6Children.push($('#acc-chd'+i+'-room6').val());}
room6['ChildrenAges']=room6Children;}
rooms.push(room6);}
if($("#acc-rooms").val()>6&&$('#acc-room7-adt').val()!='0'){var room7={Adults:$('#acc-room7-adt').val(),Children:$('#acc-room7-chd').val()}
if($('#acc-room7-chd').val()!='0'){var room7Children=[];for(var i=1;i<=parseInt($("#acc-room7-chd").val());i++){if($('#acc-chd'+i+'-room7').val()<0){return null;}
room7Children.push($('#acc-chd'+i+'-room7').val());}
room7['ChildrenAges']=room7Children;}
rooms.push(room7);}
if($("#acc-rooms").val()>7&&$('#acc-room8-adt').val()!='0'){var room8={Adults:$('#acc-room8-adt').val(),Children:$('#acc-room8-chd').val()}
if($('#acc-room8-chd').val()!='0'){var room8Children=[];for(var i=1;i<=parseInt($("#acc-room8-chd").val());i++){if($('#acc-chd'+i+'-room8').val()<0){return null;}
room8Children.push($('#acc-chd'+i+'-room8').val());}
room8['ChildrenAges']=room8Children;}
rooms.push(room8);}
if($("#acc-rooms").val()>8&&$('#acc-room9-adt').val()!='0'){var room9={Adults:$('#acc-room9-adt').val(),Children:$('#acc-room9-chd').val()}
if($('#acc-room9-chd').val()!='0'){var room9Children=[];for(var i=1;i<=parseInt($("#acc-room9-chd").val());i++){if($('#acc-chd'+i+'-room9').val()<0){return null;}
room9Children.push($('#acc-chd'+i+'-room9').val());}
room9['ChildrenAges']=room9Children;}
rooms.push(room9);}}
catch(e){alert(e.message);return null;}
return rooms;}
function getAccTotalAdults(noOfRooms){var ta=0;for(var i=1;i<=noOfRooms;i++){ta+=parseInt($("#acc-room"+i+"-adt").val());}
return ta;}
function getAccTotalChildren(noOfRooms){var tc=0;for(var i=1;i<=noOfRooms;i++){tc+=parseInt($("#acc-room"+i+"-chd").val());}
return tc;}
function searchAcc(){var fields=[];if($("#ddl-option").length>0){fields.push({elementId:"ddl-option",value:""})}
fields.push({elementId:"acc-datein",value:""})
fields.push({elementId:"acc-dateout",value:""})
var hiddenFields=[]
hiddenFields.push({elementId:"acc-dest-code",value:"",highlightElementId:"acc-dest"})
var f=validateFormFields(fields);var hf=validateHiddenFormFields(hiddenFields);if(!f||!hf){return false;}
activeButton=$("#btn-acc");if(!CheckOptions()){return false;}
var url=aurl;rl+="?vs=3";try{var dd1=$.datepicker.formatDate('yy-mm-dd',$('#acc-datein').datepicker('getDate'));var dd2=$.datepicker.formatDate('yy-mm-dd',$('#acc-dateout').datepicker('getDate'));var ta=getAccTotalAdults($("#acc-rooms").val());var tc=getAccTotalChildren($("#acc-rooms").val());switch(ardt){case 1:break;case 2:url+='&cty='+$("#acc-city").val();url+='&typ='+$("#acc-type").val();url+='&di='+dd1;url+='&do='+dd2;url+='&rms='+$('#acc-rooms').val();url+='&adt='+$('#acc-adults').val();url+='&chd='+$('#acc-children').val();url+='&txtURL='+rl;break;case 3:break;case 4:url+="&LAN=EN&PRE=F&PT=H";url+='&DESLT=OJ';url+='&RESIDENT_COUNTRY='+$("#acc-cor").val();url+='&DES='+$("#acc-dest-code").val();url+='&DD1='+dd1;url+='&DD2='+dd2;if($("#acc-hotel-code").val()){url+='&OJC='+$("#acc-hotel-code").val();}
var roomDetail;if(vitality){roomDetail=getRoomsDetail();if(!roomDetail){var msg="<b>Cannot proceed with search</b><br />Please specify the ages of all children at time of travel";$("#window").dialog("close");showError(msg,500,500,"e");ignore=true;return false;}}
else{url+='&TA='+ta;if(tc>0){url+='&TC='+tc;}
url+='&NOR='+$('#acc-rooms').val();url+='&NA1='+$('#acc-room1-adt').val();if($('#acc-room1-chd').val()!='0'){url+='&NC1='+$('#acc-room1-chd').val();for(var i=1;i<=parseInt($("#acc-room1-chd").val());i++){url+='&AC1'+i+'='+$('#acc-chd'+i+'-room1').val();}}
if($("#acc-rooms").val()=='2'&&$('#acc-room2-adt').val()!='0'){url+='&NA2='+$('#acc-room2-adt').val();}
if($("#acc-rooms").val()=='2'&&$('#acc-room2-chd').val()!='0'){url+='&NC2='+$('#acc-room2-chd').val();for(var i=1;i<=parseInt($("#acc-room2-chd").val());i++){url+='&AC2'+i+'='+$('#acc-chd'+i+'-room2').val();}}
if($("#acc-rooms").val()=='3'&&$('#acc-room2-adt').val()!='0'){url+='&NA2='+$('#acc-room2-adt').val();}
if($("#acc-rooms").val()=='3'&&$('#acc-room2-chd').val()!='0'){url+='&NC2='+$('#acc-room2-chd').val();for(var i=1;i<=parseInt($("#acc-room2-chd").val());i++){url+='&AC2'+i+'='+$('#acc-chd'+i+'-room2').val();}}
if($("#acc-rooms").val()=='3'&&$('#acc-room3-adt').val()!='0'){url+='&NA3='+$('#acc-room3-adt').val();}
if($("#acc-rooms").val()=='3'&&$('#acc-room3-chd').val()!='0'){url+='&NC3='+$('#acc-room3-chd').val();for(var i=1;i<=parseInt($("#acc-room3-chd").val());i++){url+='&AC3'+i+'='+$('#acc-chd'+i+'-room3').val();}}}
if($("#acc-more").is(':checked')){url+='&MO=T'}else{url+='&MO=F'}
if($("#acc-more").is(':checked')&&$('#acc-rating').val()!=''){url+='&SR='+$('#acc-rating').val();}
if($("#acc-more").is(':checked')&&$('#acc-type').val()!=''){url+='&HP='+$('#acc-type').val();}
if($("#acc-more").is(':checked')&&$('#acc-name').val()!=''){url+='&HN='+$('#acc-name').val();}
if($("#acc-more").is(':checked')&&$('#acc-chain').val()!=''){url+='&HC='+$('#acc-chain').val();}
if($("#acc-more").is(':checked')&&$('#acc-location').val()!=''){url+='&LT='+$('#acc-location').val();}
if($('#acc-pnr').val()!=null&&$.trim($('#acc-pnr').val())!=''){var pnr=$.trim($('#acc-pnr').val())
url+='&PNR='+pnr.toUpperCase();url+='&SUP=1S';}
url+='&RL='+rl+'&HL='+hl;if(vitality){var hotelCode=$("#acc-dest-code").val();if($("#acc-hotel-code").val()){hotelCode=$("#acc-hotel-code").val();}
var searchCriteria=JSON.stringify({hotel:$("#acc-dest").val(),HotelCode:hotelCode,Destination:$("#acc-dest-code").val(),CheckIn:dd1,CheckOut:dd2,Rooms:getRoomsDetail(),CardBooster:$('#acc-vitalityCC').is(':checked')});var postData={json:searchCriteria};$.ajax({cache:false,type:"GET",traditional:true,dataType:"json",data:postData,url:"/discovery/validatehotelselector",error:function(obj,text,errorMessage){var msg="An unexpected error occurred while processing your selection. Please refresh the page or restart the booking process.";$("#window").dialog("close");showError(msg,500,500,"e");},success:function(data){if(data.Successful){var redirectURL='/selectorhotelredirect?url='+url.replace('?','%3F').replace(/&/g,'%26')+'&json='+encodeURIComponent(searchCriteria);window.location.href=redirectURL;}else{$("#window").dialog("close");showError(data.Message,500,500,"e",data.Url);}}});}
break;}
if(!vitality){this.location.href=url.replace(/&amp;/g,'&');}}
catch(err){$("#window").dialog("close");showError("Incorrect data supplied. Please re-enter your detail and try again.",500,500,"e",rl);}}
function searchEvent(){activeButton=$("#btn-event");if(!CheckOptions()){return false;}
var url=eurl;var dd1=$.datepicker.formatDate('yy-mm-dd',$('#event-date-depart').datepicker('getDate'));var dd2=$.datepicker.formatDate('yy-mm-dd',$('#event-date-return').datepicker('getDate'));switch(erdt){case 1:case 2:case 3:break;case 4:url+="&LAN=EN&PRE=F&PT=E";url+='&DESLT=OJ';url+='&DES='+$("#event-dest-code").val();url+='&DD1='+dd1;url+='&DD2='+dd2;if($("#event-category")!=null&&$("#event-category").val()!=''){url+='&CA='+$("#event-category").val();}
url+='&TA='+$("#event-adt").val();url+='&TC='+$("#event-chd").val();if($("#event-chd").val()!='0'){for(var i=1;i<=parseInt($("#event-chd").val());i++){url+='&AC'+i+'='+$('#event-chd'+i).val();}}
if($('#event-pnr').val()!=null&&$.trim($('#event-pnr').val())!=''){var pnr=$.trim($('#event-pnr').val())
url+='&PNR='+pnr.toUpperCase();url+='&SUP=1S';}
url+='&RL='+rl+'&HL='+hl;break;}
this.location.href=url.replace(/&amp;/g,'&');}
function searchFlightAcc(){var fields=[];if($("#ddl-option").length>0){fields.push({elementId:"ddl-option",value:""})}
fields.push({elementId:"flight-acc-datein",value:""})
fields.push({elementId:"flight-acc-dateout",value:""})
var hiddenFields=[]
hiddenFields.push({elementId:"flight-acc-dest-code",value:"",highlightElementId:"flight-acc-dest"})
if(!validateFormFields(fields)||!validateHiddenFormFields(hiddenFields)){return false;}
activeButton=$("#btn-flight-acc");if(!CheckOptions()){return false;}
var url=faurl;var dd1=$.datepicker.formatDate('yy-mm-dd',$('#flight-acc-from-date').datepicker('getDate'));var dd2=$.datepicker.formatDate('yy-mm-dd',$('#flight-acc-to-date').datepicker('getDate'));var ta=parseInt($("#flight-acc-room1-adt").val());if($("#flight-acc-rooms").val()=='2'){ta+=parseInt($("#flight-acc-room2-adt").val());}
if($("#flight-acc-rooms").val()=='3'){ta+=parseInt($("#flight-acc-room2-adt").val())+parseInt($("#flight-acc-room3-adt").val());}
var tc=parseInt($("#flight-acc-room1-chd").val());if($("#flight-acc-rooms").val()=='2'){tc+=parseInt($("#flight-acc-room2-chd").val());}
if($("#flight-acc-rooms").val()=='3'){tc+=parseInt($("#flight-acc-room2-chd").val())+parseInt($("#flight-acc-room3-chd").val());}
switch(fardt){case 1:case 2:case 3:break;case 4:url+="&LAN=EN&PRE=F";url+='&PT=H&PT=F';url+='&ORILT=IATA';url+="&ORI="+$('#flight-acc-from').val();url+='&DESLT=OJ';url+='&RESIDENT_COUNTRY='+$("#flight-acc-cor").val();url+="&DES="+$('#flight-acc-dest-code').val();url+='&PACK=T';url+='&DD1='+dd1;if($('#flight-acc-from-time').val()!=''){url+='&DT1='+$('#flight-acc-from-time').val();}
url+='&DD2='+dd2;if($('#flight-acc-to-time').val()!=''){url+='&DT2='+$('#flight-acc-to-time').val();}
url+='&TA='+ta;if(tc>0){url+='&TC='+tc;}
url+='&NOR='+$('#flight-acc-rooms').val();url+='&NA1='+$('#flight-acc-room1-adt').val();if($('#flight-acc-room1-chd').val()!='0'){url+='&NC1='+$('#flight-acc-room1-chd').val();for(var i=1;i<=parseInt($("#flight-acc-room1-chd").val());i++){url+='&AC1'+i+'='+$('#flight-acc-chd'+i+'-room1').val();}}
if($("#flight-acc-rooms").val()=='2'&&$('#flight-acc-room2-adt').val()!='0'){url+='&NA2='+$('#flight-acc-room2-adt').val();}
if($("#flight-acc-rooms").val()=='2'&&$('#flight-acc-room2-chd').val()!='0'){url+='&NC2='+$('#flight-acc-room2-chd').val();for(var i=1;i<=parseInt($("#flight-acc-room2-chd").val());i++){url+='&AC2'+i+'='+$('#flight-acc-chd'+i+'-room2').val();}}
if($("#flight-acc-rooms").val()=='3'&&$('#flight-acc-room2-adt').val()!='0'){url+='&NA2='+$('#flight-acc-room2-adt').val();}
if($("#flight-acc-rooms").val()=='3'&&$('#flight-acc-room2-chd').val()!='0'){url+='&NC2='+$('#flight-acc-room2-chd').val();for(var i=1;i<=parseInt($("#flight-acc-room2-chd").val());i++){url+='&AC2'+i+'='+$('#flight-acc-chd'+i+'-room2').val();}}
if($("#flight-acc-rooms").val()=='3'&&$('#flight-acc-room3-adt').val()!='0'){url+='&NA3='+$('#flight-acc-room3-adt').val();}
if($("#flight-acc-rooms").val()=='3'&&$('#flight-acc-room3-chd').val()!='0'){url+='&NC3='+$('#flight-acc-room3-chd').val();for(var i=1;i<=parseInt($("#flight-acc-room3-chd").val());i++){url+='&AC3'+i+'='+$('#flight-acc-chd'+i+'-room3').val();}}
if($("#flight-acc-more").attr('checked')){url+='&MO=T'}else{url+='&MO=F'}
if($("#flight-acc-more").attr('checked')&&$('#flight-acc-rating').val()!=''){url+='&SR='+$('#flight-acc-rating').val();}
if($("#flight-acc-more").attr('checked')&&$('#flight-acc-type').val()!=''){url+='&HP='+$('#flight-acc-type').val();}
if($("#flight-acc-more").attr('checked')&&$('#flight-acc-name').val()!=''){url+='&HN='+$('#flight-acc-name').val();}
if($("#flight-acc-more").attr('checked')&&$('#flight-acc-chain').val()!=''){url+='&HC='+$('#flight-acc-chain').val();}
if($("#flight-acc-more").attr('checked')&&$('#flight-acc-location').val()!=''){url+='&LT='+$('#flight-acc-location').val();}
url+='&RL='+rl+'&HL='+hl;break;}
this.location.href=url.replace(/&amp;/g,'&');;}
function searchFlightCar(){var fields=[];if($("#ddl-option").length>0){fields.push({elementId:"ddl-option",value:""})}
fields.push({elementId:"flight-car-from-date",value:""})
fields.push({elementId:"flight-car-to-date",value:""})
if(!validateFormFields(fields)){return false;}
activeButton=$("#btn-flight-car");if(!CheckOptions()){return false;}
var url=fcurl;var dd1=$.datepicker.formatDate('yy-mm-dd',$('#flight-car-from-date').datepicker('getDate'));var dd2=$.datepicker.formatDate('yy-mm-dd',$('#flight-car-to-date').datepicker('getDate'));switch(fcrdt){case 1:case 2:case 3:break;case 4:url+="&LAN=EN&PRE=F";url+='&PT=V&PT=F';url+='&ORILT=IATA';url+="&ORI="+$('#flight-car-from').val();url+='&DESLT=IATA';url+="&DES="+$('#flight-car-to').val();url+='&PACK=T';url+='&DD1='+dd1;if($('#flight-car-from-time').val()!=''){url+='&DT1='+$('#flight-car-from-time').val();}
url+='&DD2='+dd2;if($('#flight-car-to-time').val()!=''){url+='&DT2='+$('#flight-car-to-time').val();}
url+='&TA='+$('#flight-car-adt').val();if($('#flight-car-chd').val()!='0'){url+='&TC='+$('#flight-car-chd').val();}
if($('#flight-car-inf').val()!='0'){url+='&TI='+$('#flight-car-inf').val();}
url+='&RL='+rl+'&HL='+hl;break;}
this.location.href=url.replace(/&amp;/g,'&');}
function searchFlightAccCar(){var fields=[];if($("#ddl-option").length>0){fields.push({elementId:"ddl-option",value:""})}
fields.push({elementId:"flight-acc-car-from-date",value:""})
fields.push({elementId:"flight-acc-car-to-date",value:""})
var hiddenFields=[]
hiddenFields.push({elementId:"flight-acc-car-dest-code",value:"",highlightElementId:"flight-acc-car-dest"})
if(!validateFormFields(fields)||!validateHiddenFormFields(hiddenFields)){return false;}
activeButton=$("#btn-flight-acc-car");if(!CheckOptions()){return false;}
var url=facurl;var dd1=$.datepicker.formatDate('yy-mm-dd',$('#flight-acc-car-from-date').datepicker('getDate'));var dd2=$.datepicker.formatDate('yy-mm-dd',$('#flight-acc-car-to-date').datepicker('getDate'));var ta=parseInt($("#flight-acc-car-room1-adt").val());if($("#flight-acc-car-rooms").val()=='2'){ta+=parseInt($("#flight-acc-car-room2-adt").val());}
if($("#flight-acc-car-rooms").val()=='3'){ta+=parseInt($("#flight-acc-car-room2-adt").val())+parseInt($("#flight-acc-car-room3-adt").val());}
var tc=parseInt($("#flight-acc-car-room1-chd").val());if($("#flight-acc-car-rooms").val()=='2'){tc+=parseInt($("#flight-acc-car-room2-chd").val());}
if($("#flight-acc-car-rooms").val()=='3'){tc+=parseInt($("#flight-acc-car-room2-chd").val())+parseInt($("#flight-acc-car-room3-chd").val());}
switch(facrdt){case 1:case 2:case 3:break;case 4:url+="&LAN=EN&PRE=F";url+='&PT=H&PT=F&PT=V';url+='&ORILT=IATA';url+="&ORI="+$('#flight-acc-car-from').val();url+='&DESLT=OJ';url+='&RESIDENT_COUNTRY='+$("#flight-acc-car-cor").val();url+="&DES="+$('#flight-acc-car-dest-code').val();url+='&PACK=T';url+='&DD1='+dd1;if($('#flight-acc-car-from-time').val()!=''){url+='&DT1='+$('#flight-acc-car-from-time').val();}
url+='&DD2='+dd2;if($('#flight-acc-car-to-time').val()!=''){url+='&DT2='+$('#flight-acc-car-to-time').val();}
url+='&TA='+ta;if(tc>0){url+='&TC='+tc;}
url+='&NOR='+$('#flight-acc-car-rooms').val();url+='&NA1='+$('#flight-acc-car-room1-adt').val();if($('#flight-acc-car-room1-chd').val()!='0'){url+='&NC1='+$('#flight-acc-car-room1-chd').val();for(var i=1;i<=parseInt($("#flight-acc-car-room1-chd").val());i++){url+='&AC1'+i+'='+$('#flight-acc-car-chd'+i+'-room1').val();}}
if($("#flight-acc-car-rooms").val()=='2'&&$('#flight-acc-car-room2-adt').val()!='0'){url+='&NA2='+$('#flight-acc-car-room2-adt').val();}
if($("#flight-acc-car-rooms").val()=='2'&&$('#flight-acc-car-room2-chd').val()!='0'){url+='&NC2='+$('#flight-acc-car-room2-chd').val();for(var i=1;i<=parseInt($("#flight-acc-car-room2-chd").val());i++){url+='&AC2'+i+'='+$('#flight-acc-car-chd'+i+'-room2').val();}}
if($("#flight-acc-car-rooms").val()=='3'&&$('#flight-acc-car-room2-adt').val()!='0'){url+='&NA2='+$('#flight-acc-car-room2-adt').val();}
if($("#flight-acc-car-rooms").val()=='3'&&$('#flight-acc-car-room2-chd').val()!='0'){url+='&NC2='+$('#flight-acc-car-room2-chd').val();for(var i=1;i<=parseInt($("#flight-acc-car-room2-chd").val());i++){url+='&AC2'+i+'='+$('#flight-acc-car-chd'+i+'-room2').val();}}
if($("#flight-acc-car-rooms").val()=='3'&&$('#flight-acc-car-room3-adt').val()!='0'){url+='&NA3='+$('#flight-acc-car-room3-adt').val();}
if($("#flight-acc-car-rooms").val()=='3'&&$('#flight-acc-car-room3-chd').val()!='0'){url+='&NC3='+$('#flight-acc-car-room3-chd').val();for(var i=1;i<=parseInt($("#flight-acc-car-room3-chd").val());i++){url+='&AC3'+i+'='+$('#flight-acc-car-chd'+i+'-room3').val();}}
if($("#flight-acc-car-more").is(':checked')){url+='&MO=T'}else{url+='&MO=F'}
if($("#flight-acc-car-more").is(':checked')&&$('#flight-acc-car-rating').val()!=''){url+='&SR='+$('#flight-acc-car-rating').val();}
if($("#flight-acc-car-more").is(':checked')&&$('#flight-acc-car-type').val()!=''){url+='&HP='+$('#flight-acc-car-type').val();}
if($("#flight-acc-car-more").is(':checked')&&$('#flight-acc-car-name').val()!=''){url+='&HN='+$('#flight-acc-car-name').val();}
if($("#flight-acc-car-more").is(':checked')&&$('#flight-acc-car-chain').val()!=''){url+='&HC='+$('#flight-acc-car-chain').val();}
if($("#flight-acc-car-more").is(':checked')&&$('#flight-acc-car-location').val()!=''){url+='&LT='+$('#flight-acc-car-location').val();}
url+='&RL='+rl+'&HL='+hl;break;}
this.location.href=url.replace(/&amp;/g,'&');}
function changeModifySearchHeight(addSubtract){if(document.location.href.toLowerCase().indexOf('window')>0){var height=parseInt($(top.document).find("iframe").css("height"))+(addSubtract);$(top.document).find("iframe").css("height",height);}}
function resetModifySearchHeight(type){if(document.location.href.toLowerCase().indexOf('window')>0){var height=600;if(type=="MC"){height=750;if($("#div-multi-from5").is(":visible")){height+=75;}
if($("#div-multi-from4").is(":visible")){height+=75;}
if($("#div-multi-from3").is(":visible")){height+=75;}}
if($("input:checkbox[id^='discovery_']").length>0){height+=120;height+=$("input:checkbox[id^='discovery_']").length*30;}
$(top.document).find("iframe").css("height",height);}}
function validateDiscoveryUsage(segmentCount){var count=0;if(fint&&$("#ddlServiceClass").val()<3){segmentCount=1;}
$("[id^='member_benefits_']").each(function(){var elementId=$(this).attr('id');var id=elementId.split('_');if($("#discovery_"+id[2]).prop("checked")){var vitalityAllocation=parseInt($("#vitalityAllocation_"+id[2]).attr("allocation"));var baseAllocation=parseInt($("#baseAllocation_"+id[2]).attr("allocation"));var superAllocation=parseInt($("#superAllocation_"+id[2]).attr("allocation"));var vitalitySufficient=true;var baseSufficient=true;var superSufficient=true;var hasFlatRate=false;hasFlatRate=fint&&$("#flatRateDiscounts_"+id[2]).length;vitalitySufficient=isNaN(vitalityAllocation)||vitalityAllocation>=segmentCount;baseSufficient=isNaN(baseAllocation)||baseAllocation>=segmentCount;superSufficient=isNaN(superAllocation)||superAllocation>=segmentCount;if(!vitalitySufficient&&!baseSufficient&&!superSufficient&&!hasFlatRate){$("#discovery_"+id[2]).prop('disabled',true);$("#discovery_"+id[2]).prop('checked',false);$("#member_benefits_"+id[2]).removeClass('active');count++;}
else{$("#discovery_"+id[2]).prop('disabled',false);if(!vitalitySufficient){$("#vitalityDiscount_"+id[2]).prop('disabled',true);$("#purpleDiscount_"+id[2]).prop('disabled',true);$('.benefit vitality').addClass('disabled');count++;}
else{$("#vitalityDiscount_"+id[2]).prop('disabled',false);$("#purpleDiscount_"+id[2]).prop('disabled',false);$('.benefit vitality').removeClass('disabled');if($("#purpleDiscount_"+id[2]).is(':checked')){$('input[name^="bankDiscount_'+id[1]+'"]').prop('disabled',true);}}
if(!baseSufficient){$("#baseDiscount_"+id[2]).prop('disabled',true);$("#baseDiscount_"+id[2]).prop('checked',false);$("#baseBankDiscount_"+id[2]).addClass('nousage');$("#baseBankDiscount_"+id[2]).removeClass('selected');}
else{if(!$("#purpleDiscount_"+id[2]).is(':checked')||$("#purpleDiscount_"+id[2]).prop('disabled')){$("#baseDiscount_"+id[2]).prop('disabled',false);$("#baseBankDiscount_"+id[2]).removeClass('nousage');}
if(!$("#superDiscount_"+id[2]).is(':checked')){$("#baseBankDiscount_"+id[2]).addClass('selected');$("#baseDiscount_"+id[2]).prop('checked',true);}}
if(!superSufficient){$("#superDiscount_"+id[2]).prop('checked',false);$("#superBankDiscount_"+id[2]).removeClass('selected');$("#superDiscount_"+id[2]).prop('disabled',true);$("#superBankDiscount_"+id[2]).addClass('nousage');}
else{if(!$("#purpleDiscount_"+id[2]).is(':checked')||$("#purpleDiscount_"+id[2]).prop('disabled')){if(!$("#baseDiscount_"+id[2]).is(':checked')){$("#superBankDiscount_"+id[2]).addClass('selected');}
$("#superBankDiscount_"+id[2]).removeClass('nousage');$("#superDiscount_"+id[2]).prop('disabled',false);}}}
calculateDiscountTotal(id[2]);}});if(count>0){$("#AvailableUsageError").show();}
else{$("#AvailableUsageError").hide();}}
function searchArray(list){}